var Gamee;!function(t){var e=function(){function t(e,i){void 0===i&&(i=!1),this.onFirstRestart=new Phaser.Signal,this._onFirstRestartCalled=!1,this._game=null,this._gameeController=null,this._indices={right:1,up:2,left:4,down:8,A:16,B:32,button:64},this._pressesCache=0,this._isDown=0,this._justDown=0,this._justUp=0,this._gameRunning=!1,this._score=0,void 0!==window.gamee&&(null===e||("Touch"!==e?(this._gameeController=window.gamee.controller.requestController(e,{enableKeyboard:i}),this.keyHandlers()):(this._gameeController=window.gamee.controller.requestController("Touch"),this.touchHandlers()))),this.eventHandlers(),t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return null===t._instance,t._instance},enumerable:!0,configurable:!0}),t.prototype.setGame=function(t){this._game=t},Object.defineProperty(t.prototype,"gameRunning",{get:function(){return this._gameRunning},enumerable:!0,configurable:!0}),t.prototype.keyHandlers=function(){var t=this;this._gameeController.on("keydown",function(e){App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - keydown"),t._pressesCache|=t._indices[e.button];var i=t._game.state.getCurrentState();"function"==typeof i.onGameeButtonDown&&i.onGameeButtonDown(e.button)}),this._gameeController.on("keyup",function(e){t._pressesCache&=~t._indices[e.button];var i=t._game.state.getCurrentState();"function"==typeof i.onGameeButtonUp&&i.onGameeButtonUp(e.button)})},t.prototype.processKeys=function(){var t=this._isDown;this._isDown=this._pressesCache;var e=t^this._isDown;this._justDown=e&this._isDown,this._justUp=e&~this._isDown},t.prototype.clearKeys=function(){this._pressesCache=0,this._isDown=0,this._justDown=0,this._justUp=0},t.prototype.isDown=function(t){return(this._isDown&this._indices[t])>0},t.prototype.justDown=function(t){return(this._justDown&this._indices[t])>0},Object.defineProperty(t.prototype,"anyIsDown",{get:function(){return this._isDown>0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anyJustDown",{get:function(){return this._justDown>0},enumerable:!0,configurable:!0}),t.prototype.isUp=function(t){return!this.isDown(t)},t.prototype.justUp=function(t){return(this._justUp&this._indices[t])>0},t.prototype.touchHandlers=function(){var t=this;this._gameeController.on("touchstart",function(e){var i=t._game.state.getCurrentState();"function"==typeof i.onGameeTouchStart&&i.onGameeTouchStart(e)}),this._gameeController.on("touchend",function(e){var i=t._game.state.getCurrentState();"function"==typeof i.onGameeTouchEnd&&i.onGameeTouchEnd(e)}),this._gameeController.on("touchmove",function(e){var i=t._game.state.getCurrentState();"function"==typeof i.onGameeTouchMove&&i.onGameeTouchMove(e)}),this._gameeController.on("touchleave",function(e){var i=t._game.state.getCurrentState();"function"==typeof i.onGameeTouchLeave&&i.onGameeTouchLeave(e)}),this._gameeController.on("touchcancel",function(e){var i=t._game.state.getCurrentState();"function"==typeof i.onGameeTouchCancel&&i.onGameeTouchCancel(e)})},t.prototype.eventHandlers=function(){var t=this;window.gamee.onPause=function(){t.onPause()},window.gamee.onUnpause=function(){t.onUnpause()},window.gamee.onRestart=function(){t.onRestart()},window.gamee.onMute=function(){t._game.onMute()},window.gamee.onUnmute=function(){t._game.onUnmute()}},t.prototype.onPause=function(){var t=this._game.state.getCurrentState();"function"==typeof t.onGameePause&&t.onGameePause()},t.prototype.onUnpause=function(){var t=this._game.state.getCurrentState();"function"==typeof t.onGameeUnpause&&t.onGameeUnpause()},t.prototype.onRestart=function(){this._onFirstRestartCalled||(this.onFirstRestart.dispatch(),this._onFirstRestartCalled=!0),App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - onRestart");var t=this._game.state.getCurrentState();"function"==typeof t.onGameeRestart&&t.onGameeRestart()},Object.defineProperty(t.prototype,"score",{get:function(){return App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - get score"),this._score},set:function(t){App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - set score "+t),this._score=t,window.gamee.score=t},enumerable:!0,configurable:!0}),t.prototype.addScore=function(t){App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - add Score +"+t),this.score+=t},t.prototype.gameStart=function(){return App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - game start"),this._gameRunning?void(App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - game start - Gamee game is already running")):(this._gameRunning=!0,this.score=0,void window.gamee.gameStart())},t.prototype.gameOver=function(){return App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - game over"),this._gameRunning?(this._gameRunning=!1,void window.gamee.gameOver()):void(App.Global.DEBUG_GAMEE&&Log.Log.msg("Gamee - game over - Gamee game is not running"))},t._instance=null,t}();t.Gamee=e}(Gamee||(Gamee={}));var Helper;!function(t){var e=function(){function t(t,e){this._rnd=t,this.reset(e)}return t.prototype.reset=function(t){--t;var e=Math.ceil(t/2);this._lbound=-e,this._ubound=t-e,this._currentBalance=0===t?this._rnd.integerInRange(-1,0):0},t.prototype.getBoolean=function(){var t=this._currentBalance+this._rnd.integerInRange(this._lbound,this._ubound);return this._currentBalance+=t>=0?-1:1,t>=0},t}();t.RandomBooleanBalancer=e}(Helper||(Helper={}));var Log;!function(t){var e=function(){function t(){}return t.msg=function(e){var i=t.messages;if(i.length<t.MAX_LINE)t.messages.push(e);else{for(var n=1;n<t.MAX_LINE;n++)i[n-1]=i[n];i[t.MAX_LINE-1]=e}},t.render=function(e){for(var i=t.messages,n=0;n<i.length;n++)e.text(i[n],50,70+16*n,"RGB(255, 0, 0)")},t.MAX_LINE=20,t.messages=[],t}();t.Log=e}(Log||(Log={}));var Helper;!function(t){var e=function(){function t(){}return t.randomizeArray=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var r=i?e.slice():e;return Phaser.ArrayUtils.shuffle(r),n?r.slice(0,t):r},t.sort=function(e,i,n,r){if(void 0===n&&(n=0),void 0===r&&(r=e.length),r>n){for(var s,a=n,o=n+1;r>=o;o++)i(e[n],e[o])>0&&(s=e[++a],e[a]=e[o],e[o]=s);s=e[n],e[n]=e[a],e[a]=s,t.sort(e,i,n,a-1),t.sort(e,i,a+1,r)}},t}();t.ArrayUtils=e}(Helper||(Helper={}));var Helper;!function(t){var e;!function(t){function e(t,e,i){var n=t*Math.PI*2*e,r=t*(2*Math.PI*i+Math.PI/2);return Math.sin(n)*Math.cos(r)}function i(t,e,i){var n=t*Math.PI*2*e,r=-t*i;return Math.sin(n)*Math.exp(r)}function n(t){return-2*t*t+3*t}function r(t){return-(n(1-t)-1)}function s(t){return Math.sin(2*t*Math.PI)}function a(t){return Math.sin(t*Math.PI)}function o(t,e){return Math.sin(2*t*Math.PI*e)}function h(t){return-3.379795897*t*t+4.379795897*t}t.wiggle=e,t.sinWithExpDecay=i,t.pop5=n,t.pop5rev=r,t.sin=s,t.halfSin=a,t.sinWithPeriod=o,t.overshoot=h}(e=t.Easing||(t.Easing={}))}(Helper||(Helper={}));var Helper;!function(t){var e=function(){function t(){}return t.create=function(e,i,n,r,s,a,o,h,p,l){return void 0===a&&(a=0),void 0===o&&(o=0),void 0===h&&(h=0),void 0===p&&(p=0),void 0===l&&(l=!1),t._image=new Phaser.Image(e,0,0,r),"string"==typeof s?t._frame=e.cache.getFrameByName(r,s):t._frame=e.cache.getFrameByIndex(r,s),t.calculateNineImage(i,n,a,o,h,p,l),t._nineImage=new Phaser.BitmapData(e,"NineImage"+t._textureKey++,t._width,t._height),t.renderNineImage(),t._nineImage},t.calculateNineImage=function(e,i,n,r,s,a,o){var h=t._frame;if(t._centralWidth=h.width-r-a,t._centralHeight=h.height-n-s,o)t._horizontalRepeats=e,t._verticalRepeats=i,t._width=r+a+t._centralWidth*e,t._height=n+s+t._centralHeight*i,t._lastWidth=0,t._lastHeight=0;else{var p=e-r-a;t._horizontalRepeats=Math.floor(p/t._centralWidth),t._lastWidth=p%t._centralWidth;var l=i-n-s;t._verticalRepeats=Math.floor(l/t._centralHeight),t._lastHeight=l%t._centralHeight,t._width=e,t._height=i}t._leftWidth=r,t._rightWidth=a,t._topHeight=n,t._bottomHeight=s},t.renderNineImage=function(){var e=t._frame.y,i=0;t._topHeight>0&&(t.renderNineImageRow(t._image,e,i,t._topHeight),e+=t._topHeight,i+=t._topHeight);for(var n=0;n<t._verticalRepeats;n++)t.renderNineImageRow(t._image,e,i,t._centralHeight),i+=t._centralHeight;t._lastHeight>0&&(t.renderNineImageRow(t._image,e,i,t._lastHeight),i+=t._lastHeight),e+=t._centralHeight,t._bottomHeight>0&&t.renderNineImageRow(t._image,e,i,t._bottomHeight)},t.renderNineImageRow=function(e,i,n,r){var s=t._frame.x,a=0;t._leftWidth>0&&(t._nineImage.copy(e,s,i,t._leftWidth,r,a,n),a+=t._leftWidth,s+=t._leftWidth);for(var o=0;o<t._horizontalRepeats;o++)t._nineImage.copy(e,s,i,t._centralWidth,r,a,n),a+=t._centralWidth;t._lastWidth>0&&(t._nineImage.copy(e,s,i,t._lastWidth,r,a,n),a+=t._lastWidth),s+=t._centralWidth,t._rightWidth>0&&t._nineImage.copy(e,s,i,t._rightWidth,r,a,n)},t._textureKey=0,t}();t.NineImage=e}(Helper||(Helper={}));var Helper;!function(t){var e;!function(t){t[t.UNDEFINED=-1]="UNDEFINED",t[t.SPACE=1]="SPACE",t[t.NEWLINE=2]="NEWLINE",t[t.CHARACTER=3]="CHARACTER"}(e||(e={}));var i=function(){function t(){}return t.hasNext=function(){return t.textPosition<t.text.length},t.getChar=function(){return t.text.charAt(t.textPosition++)},t.peekChar=function(){return t.text.charAt(t.textPosition)},t.getPosition=function(){return t.textPosition},t.setPosition=function(e){t.textPosition=e},t.getCharAdvance=function(e,i){var n=t.fontData.chars[e],r=n.xAdvance;return i>0&&n.kerning[i]&&(r+=n.kerning[i]),r},t.getCharType=function(t){return" "===t?e.SPACE:/(?:\r\n|\r|\n)/.test(t)?e.NEWLINE:e.CHARACTER},t.wrapText=function(i,n,r,s,a,o){t.text=n,t.setPosition(0),t.fontData=i.cache.getBitmapFont(a).font,void 0===o&&(o=t.fontData.size);var h=o/t.fontData.size,p=t.fontData.lineHeight*h,l=r/h,c=[],u=[],_=[],d=0,f=!0,m=0,g=0;c[d]=g,_[m++]=0;for(var y=s;t.hasNext();){for(var v=0,T=0,b=-1,I=e.UNDEFINED,A=e.UNDEFINED,E=l,S=-1;t.hasNext();){g=t.getPosition();var P=t.getChar();I=t.getCharType(P);var B=P.charCodeAt(0);if(I===e.SPACE)A!==e.SPACE&&(T=v),++v,E-=t.getCharAdvance(B,S);else if(I===e.CHARACTER){if(A!==e.CHARACTER&&(b=g),E-=t.getCharAdvance(B,S),0>E)break;++v}else if(I===e.NEWLINE){var N=!1;if(t.hasNext()&&(N=!0,T=v,b=t.getPosition(),g=b,E=-1,I=e.CHARACTER),N)break}A=I,S=B}y-=p,0>y&&(_[m++]=d),0>E&&I===e.CHARACTER?(0!==T?u[d]=T:u[d]=v,f=!1,0>y&&(f=!0,y=s-p),0!==T?(c[++d]=b,t.setPosition(b)):(c[++d]=g,t.setPosition(g))):t.hasNext()||(I===e.CHARACTER?u[d]=v:I===e.SPACE&&(u[d]=T))}_[m]=d+1;for(var O=[],M=1;m>=M;M++){for(var R=_[M-1],C=_[M],w=[],k=R;C>k;k++)w.push(t.text.substr(c[k],u[k]));O.push(w.join("\n"))}return O},t}();t.TextWrapper=i}(Helper||(Helper={}));var Particles;!function(t){var e=function(){function e(t,i){this.maxVelocity=e.MAX_VELOCITY,this._delay=0,this._velocity=new Phaser.Point(0,0),this._angularVelocity=0,this._friction=0,this._angularDrag=0,this._gravity=0,this._alpha=1,this._scaleChange=0,this._alphaChange=0,this._game=t}return Object.defineProperty(e.prototype,"visual",{get:function(){return this._visual},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"on",{set:function(t){this._on=t,this._visual.exists=t,this._visual.visible=t},enumerable:!0,configurable:!0}),e.prototype.remove=function(){var t=this._visual.parent;null!==t&&(t instanceof Phaser.Group?t.remove(this._visual):t.removeChild(this._visual),t=null)},e.prototype.bringToTop=function(){var t=this._visual.parent;t instanceof Phaser.Group&&t.bringToTop(this._visual)},e.prototype.sendToBack=function(){var t=this._visual.parent;t instanceof Phaser.Group&&t.sendToBack(this._visual)},Object.defineProperty(e.prototype,"textureKey",{set:function(t){this._textureKey=t},enumerable:!0,configurable:!0}),e.prototype.setScaleChange=function(t,e){void 0===e&&(e=0),this._scaleChangeType=t,this._scaleChange=e},Object.defineProperty(e.prototype,"delay",{set:function(t){this._delay=t,t>0&&(this.on=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{set:function(t){this._alpha=t,this._visual.alpha=Phaser.Math.clamp(t,0,1)},enumerable:!0,configurable:!0}),e.prototype.setAlphaChange=function(t,e){void 0===e&&(e=0),this._alphaChangeType=t,this._alphaChange=e},e.prototype.setPhysics=function(t,e,i,n,r,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),this._velocity.setTo(t,e),this._angularVelocity=i,this._friction=n,this._angularDrag=r,this._gravity=s,this._simplePhysics=0===s&&0===n&&0===r},e.prototype.setFrame=function(t){},e.prototype.onEmit=function(t){t.add(this._visual)},e.prototype.onKill=function(t){},e.prototype.update=function(e){void 0===e&&(e=!0);var i=this._game.time.physicsElapsed;if(this._delay>0){if((this._delay-=i)>0)return!0;this.on=!0}if(this.lifetime>0&&(this.lifetime-=i)<=0)return!1;if((0!==this._velocity.x||0!==this._velocity.y)&&(this._visual.x+=this._velocity.x*i,this._visual.y+=this._velocity.y*i),0!==this._angularVelocity&&(this._visual.angle+=this._angularVelocity*i),this._simplePhysics||(this._velocity.x+=-this._friction*this._velocity.x*i,this._velocity.y+=(this._gravity-this._friction*this._velocity.y)*i,this._angularVelocity+=-this._angularDrag*this._angularVelocity*i),!e)return!0;if(this._scaleChangeType!=t.eParameterChangeType.NO_CHANGE)switch(this._scaleChangeType){case t.eParameterChangeType.IN_TIME:(this._visual.scale.x+=this._scaleChange*i)<0&&(this._visual.scale.x=0,this._scaleChange<0&&(this._scaleChangeType=t.eParameterChangeType.NO_CHANGE)),(this._visual.scale.y+=this._scaleChange*i)<0&&(this._visual.scale.y=0,this._scaleChange<0&&(this._scaleChangeType=t.eParameterChangeType.NO_CHANGE))}if(this._alphaChangeType!=t.eParameterChangeType.NO_CHANGE)switch(this._alphaChangeType){case t.eParameterChangeType.IN_TIME:this._alpha+=this._alphaChange*i,this._alpha<0?(this._visual.alpha=0,this._alphaChange<0&&(this._alphaChangeType=t.eParameterChangeType.NO_CHANGE)):this._alpha>1?(this._visual.alpha=1,this._alphaChange>0&&(this._alphaChangeType=t.eParameterChangeType.NO_CHANGE)):this._visual.alpha=this._alpha}return!0},e.MAX_VELOCITY=1e3,e}();t.Particle=e}(Particles||(Particles={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Particles;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setFrame=function(t){var e=this._visual;"string"==typeof t?e.frameName=t:e.frame=t},e.prototype.onCreate=function(t){var e=new Phaser.Sprite(this._game,0,0,this._textureKey);e.anchor.setTo(.5,.5),this._visual=e},e}(t.Particle);t.SpriteParticle=e}(Particles||(Particles={}));var Particles;!function(t){var e=function(t){function e(e,i){t.call(this,e,i),(void 0===i||null!==i)&&(this._anims=i[0])}return __extends(e,t),e.prototype.onCreate=function(e){t.prototype.onCreate.call(this,e);for(var i=this._visual,n=0;n<this._anims.length;n++){var r=this._anims[n],s=i.animations.add(r.name,r.frames,r.frameRate,r.loop);!r.loop&&r.killOnComplete&&(s.killOnComplete=!0)}},e.prototype.update=function(e){void 0===e&&(e=!0);var i=this._delay,n=t.prototype.update.call(this,e);return i>0&&this._delay<=0&&this._visual.animations.currentAnim.play(),n},e.prototype.setFrame=function(t){this.setAnim(t)},e.prototype.setAnim=function(t){var e=this._visual;e.animations.stop(null,!0),this._delay<=0?e.animations.play(t):(e.animations.currentAnim=e.animations.getAnimation(t),e.frame=e.animations.currentAnim._frames[0])},e.prototype.setRandomAnim=function(){var t=(this._visual,this._anims[this._game.rnd.integerInRange(0,this._anims.length-1)].name);this.setAnim(t)},e}(t.SpriteParticle);t.AnimatedParticle=e}(Particles||(Particles={}));var Particles;!function(t){var e=function(){function e(e){this.area=new Phaser.Point(0,0),this.gravity=0,this.minLifetime=1,this.maxLifetime=1,this.delay=0,this.minScale=1,this.maxScale=1,this.scaleChange=0,this.scaleChangeType=t.eParameterChangeType.NO_CHANGE,this.minAngle=0,this.maxAngle=0,this.minSpeedX=0,this.maxSpeedX=0,this.minSpeedY=0,this.maxSpeedY=0,this.friction=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.angularDrag=0,this.minAlpha=1,this.maxAlpha=1,this.alphaChange=0,this.alphaChangeType=t.eParameterChangeType.NO_CHANGE,this.frames=null,this._minAdvScale=new Phaser.Point(1,1),this._maxAdvScale=new Phaser.Point(1,1),this._game=e}return e.readParams=function(t,i){var n={};for(var r in i){var s=new e(t);e.doReadParams(s,i,r),n[r]=s}return n},e.doReadParams=function(t,i,n){var r=i[n];if("undefined"!=typeof r.parent&&null!==r.parent){var s=r.parent;e.doReadParams(t,i,s)}for(var a in r)"parent"!==a&&("undefined"==typeof t[a],t[a]=r[a])},e.prototype.clear=function(){this.gravity=0,this.setXSpeed(0,0),this.setYSpeed(0,0),this.setAngularSpeed(0)},e.prototype.randomFrame=function(){var t=null;return null!==this.frames&&(t=Array.isArray(this.frames)?"string"==typeof this.frames[0]?this._game.rnd.pick(this.frames):this._game.rnd.pick(this.frames):this.frames),t},e.prototype.setXSpeed=function(t,e){t=t||0,e=e||0,this.minSpeedX=t,this.maxSpeedX=e},e.prototype.setYSpeed=function(t,e){t=t||0,e=e||0,this.minSpeedY=t,this.maxSpeedY=e},e.prototype.setAngularSpeed=function(t,e){t=t||0,e=e||0,this.minAngularSpeed=t,this.maxAngularSpeed=e},e.prototype.setAlpha=function(t,e){void 0===t&&(t=1),void 0===e&&(e=1),this.minAlpha=t,this.maxAlpha=e},e.prototype.setAlphaChange=function(e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),this.alphaChangeType=e,e){case t.eParameterChangeType.NO_CHANGE:this.alphaChange=0;break;case t.eParameterChangeType.IN_TIME:0===n&&(n=1),this.alphaChange=i/n}},e.prototype.setScale=function(t,e){t=t||0,e=e||0,this.minScale=t,this.maxScale=e},Object.defineProperty(e.prototype,"advScaleMin",{get:function(){return this._minAdvScale},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"advScaleMax",{get:function(){return this._maxAdvScale},enumerable:!0,configurable:!0}),e.prototype.setAdvScale=function(t,e,i,n){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=1),this._minAdvScale.setTo(t,i),this._maxAdvScale.setTo(e,n)},e.prototype.setScaleChange=function(e,i,n){switch(void 0===i&&(i=0),void 0===n&&(n=0),this.scaleChangeType=e,e){case t.eParameterChangeType.NO_CHANGE:this.scaleChange=0;break;case t.eParameterChangeType.IN_TIME:0===n&&(n=1),this.scaleChange=i/n}},e.prototype.setAngle=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.minAngle=t,this.maxAngle=e},e}();t.ParticleParams=e}(Particles||(Particles={}));var Particles;!function(t){var e;!function(t){t[t.NONE=0]="NONE",t[t.FLOW=1]="FLOW",t[t.EXPLODE=2]="EXPLODE"}(e||(e={})),function(t){t[t.NO_CHANGE=0]="NO_CHANGE",t[t.IN_TIME=1]="IN_TIME"}(t.eParameterChangeType||(t.eParameterChangeType={}));var i=t.eParameterChangeType,n=function(n){function r(i,s,a,o){n.call(this,i,null),this._maxParticles=r.MAX_PARTICELES,this.emitPoint=new Phaser.Point(0,0),this.emitObject=null,this.particleClass=t.SpriteParticle,this.particleBringToTop=!1,this.particleSendToBack=!1,this.frequency=100,this.forceEmit=!1,this._alternativeParams=null,this._on=!1,this._mode=e.NONE,this._flowQuantity=0,this._flowTotal=0,this._flowCounter=0,this._particlesPool=[],this._counterPool=0,this._particlesUsed=[],this._counterUsed=0,this._timer=0,this._emitPoint=new Phaser.Point(0,0),this._params=new t.ParticleParams(i),this.position.setTo(s,a),this._maxParticles=o}return __extends(r,n),Object.defineProperty(r.prototype,"params",{get:function(){return this._params},set:function(t){this._params=t},enumerable:!0,configurable:!0}),r.prototype.clear=function(){this._params.clear()},r.prototype.update=function(){if(this._on&&this.game.time.time>=this._timer&&(this._timer=this.game.time.time+this.frequency*this.game.time.slowMotion,this._mode===e.FLOW))if(-1!==this._flowTotal&&this._flowCounter>=this._flowTotal)this.stopFlow();else for(var t=Math.max(1,this._flowQuantity),i=0;t>i&&!(this.emitParticle(this.forceEmit)&&(this._flowCounter++,-1!==this._flowTotal&&this._flowCounter>=this._flowTotal));i++);for(var i=this._counterUsed-1;i>=0;i--){var n=this._particlesUsed[i];n.update()||(n.on=!1,n.remove(),n.onKill(this),this._particlesUsed[i]=this._particlesUsed[--this._counterUsed],this._particlesPool[this._counterPool++]=n)}},r.prototype.makeParticles=function(t,e,i,n){(void 0===i||i>this._maxParticles)&&(i=this._maxParticles),void 0!==e&&(this._params.frames=e);for(var r=0;i>r;r++){var s=new this.particleClass(this.game,n);s.textureKey=t,s.onCreate(this),s.on=!1,this._particlesPool[this._counterPool++]=s}},Object.defineProperty(r.prototype,"on",{set:function(t){this._on=t,this.exists=t,this.visible=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"count",{get:function(){return this._counterUsed},enumerable:!0,configurable:!0}),r.prototype.explode=function(t,i,n){this._mode=e.EXPLODE,this.on=!0,this.emitParticles(t,i,n)},r.prototype.flow=function(t,i,n,r,s,a){this._mode=e.FLOW,this.on=!0,(void 0===i||0===i)&&(i=1),void 0===n&&(n=-1),void 0===r&&(r=!0),i>this._maxParticles&&(i=this._maxParticles),this.frequency=t,this._flowCounter=0,this._flowQuantity=i,this._flowTotal=n,r&&(this.emitParticles(i,s,a),this._flowCounter+=i,this._timer=this.game.time.time+t*this.game.time.slowMotion)},r.prototype.stopFlow=function(){this._mode=e.NONE},r.prototype.killAllParticles=function(t){for(void 0===t&&(t=!0);this._counterUsed>0;){var e=this._particlesUsed[--this._counterUsed];e.remove(),t||e.onKill(this),this._particlesPool[this._counterPool++]=e}},r.prototype.emitParticles=function(t,e,i){for(var n=0;t>n;n++){var r=this.emitParticle(this.forceEmit);if(null===r)break;void 0!==e&&null!==e&&e.call(i,r)}},r.prototype.emitParticle=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),0===this._counterPool){if(!t)return null;var n=this._particlesUsed[0];this._particlesUsed[0]=this._particlesUsed[--this._counterUsed],n.remove(),n.onKill(this),this._particlesPool[this._counterPool++]=n}var r=this._particlesPool[--this._counterPool];this._particlesUsed[this._counterUsed++]=r,r.on=!0;var s=null!==this._alternativeParams?this._alternativeParams:this._params;if(this.randomEmitPoint(this._emitPoint,s),r.visual.position.set(this._emitPoint.x,this._emitPoint.y),r.visual.angle=0,e)r.lifetime=-1,r.visual.scale.set(1,1),r.setScaleChange(i.NO_CHANGE),r.visual.angle=0,r.alpha=1,r.setAlphaChange(i.NO_CHANGE),r.setPhysics();else{if(r.lifetime=this.game.rnd.realInRange(s.minLifetime,s.maxLifetime),r.delay=s.delay,1!==s.minScale||1!==s.maxScale){var a=this.game.rnd.realInRange(s.minScale,s.maxScale);r.visual.scale.set(a,a)}else s.advScaleMin.x!==s.advScaleMax.x||s.advScaleMin.y!==s.advScaleMax.y?r.visual.scale.set(this.game.rnd.realInRange(s.advScaleMin.x,s.advScaleMax.x),this.game.rnd.realInRange(s.advScaleMin.y,s.advScaleMax.y)):r.visual.scale.set(1,1);r.setScaleChange(s.scaleChangeType,s.scaleChange),r.visual.angle=s.minAngle===s.maxAngle?s.minAngle:this.game.rnd.realInRange(s.minAngle,s.maxAngle),r.alpha=this.game.rnd.realInRange(s.minAlpha,s.maxAlpha),r.setAlphaChange(s.alphaChangeType,s.alphaChange),r.setPhysics(this.game.rnd.realInRange(s.minSpeedX,s.maxSpeedX),this.game.rnd.realInRange(s.minSpeedY,s.maxSpeedY),this.game.rnd.realInRange(s.minAngularSpeed,s.maxAngularSpeed),s.friction,s.angularDrag,s.gravity),null!==s.frames&&r.setFrame(s.randomFrame())}return r.onEmit(this),this.particleBringToTop?r.bringToTop():this.particleSendToBack&&r.sendToBack(),r},r.prototype.destroy=function(){t.ParticlesManager.instance.remove(this),n.prototype.destroy.call(this,!0,!1)},r.prototype.randomEmitPoint=function(t,e){return e.area instanceof Phaser.Point?t.setTo(0,0):e.area.random(t),t.x+=this.emitPoint.x,t.y+=this.emitPoint.y,null!==this.emitObject&&(t.x+=this.emitObject.x,t.y+=this.emitObject.y),t},Object.defineProperty(r.prototype,"area",{set:function(t){this._params.area=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"gravity",{set:function(t){this._params.gravity=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"friction",{set:function(t){this._params.friction=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"angularDrag",{set:function(t){this._params.angularDrag=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minScale",{set:function(t){this._params.minScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxScale",{set:function(t){this._params.maxScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minAngle",{set:function(t){this._params.minAngle=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxAngle",{set:function(t){this._params.maxAngle=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"lifetime",{set:function(t){this._params.minLifetime=this._params.maxLifetime=t},enumerable:!0,configurable:!0}),r.prototype.setXSpeed=function(t,e){this._params.setXSpeed(t,e)},r.prototype.setYSpeed=function(t,e){this._params.setYSpeed(t,e)},r.prototype.setAngularSpeed=function(t,e){this._params.setAngularSpeed(t,e)},r.prototype.setAlpha=function(t,e){this._params.setAlpha(t,e)},r.prototype.setAlphaChange=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._params.setAlphaChange(t,e,i)},r.prototype.setScale=function(t,e){this._params.setScale(t,e)},r.prototype.setAdvScale=function(t,e,i,n){this._params.setAdvScale(t,e,i,n)},r.prototype.setScaleChange=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._params.setScaleChange(t,e,i)},r.prototype.setAngle=function(t,e){this._params.setAngle(t,e)},r.prototype.emitAt=function(t,e){this.emitPoint.setTo(t,e)},r.prototype.emitAtObject=function(t){t.center?this.emitPoint.setTo(t.center.x,t.center.y):this.emitPoint.setTo(t.x,t.y)},r.MAX_PARTICELES=16,r}(Phaser.Group);t.ParticlesEmitter=n}(Particles||(Particles={}));var Particles;!function(t){var e=function(){function t(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this._emitter=null,this._game=t,this._emitter=e,this._animEmitter=i,this._params=n}return t.prototype.emit=function(t,e,i,n,r){for(this._emitter.emitAt(t,e),null!==this._animEmitter&&this._animEmitter.emitAt(t,e);null!==i;){var s=i.animated?this._animEmitter:this._emitter;if(null===this._params&&null!==i.paramsName,null!==this._params){var a=this._params[i.paramsName];"undefined"==typeof a||(s.params=a)}s.explode(this._game.rnd.integerInRange(i.countMin,i.countMax),n,r),i=i.next}},t}();t.ParticleChain=e}(Particles||(Particles={}));var Particles;!function(t){var e=function(){function t(){this._emitters=[],this._emittersCount=0}return Object.defineProperty(t,"instance",{get:function(){return null===t._instance&&(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.add=function(t){this._emitters[this._emittersCount++]=t},t.prototype.remove=function(t){for(var e=this._emittersCount-1;e>=0&&this._emitters[e]!==t;e--);-1!==e&&(this._emitters[e]=this._emitters[--this._emittersCount])},t.prototype.update=function(){for(var t=0;t<this._emittersCount;t++){var e=this._emitters[t];e.exists&&e.update()}},t._instance=null,t}();t.ParticlesManager=e}(Particles||(Particles={}));var BlockBusters;!function(t){var e=function(){function t(){}return t.RULER_STEP=5,t.RULER_TINT=9004844,t.BRICK_SIZE=new Phaser.Point(192,64),t.MIN_HAND_RATIO=512/1152,t.BRICKS_VISIBLE=10,t.GRAVITY=1600,t.FLOOR_HEIGHT=119,t.GAME_OVER_WAIT_TIME=1,t.MOVE_TOWER=!0,t.INITIAL_HAND_MULTIPLIER=2,t.ADD_HAND_SPEED_BRICK=.2,t.BRICKS_TO_FULL_HAND_RANGE=10,t.INITIAL_BRICKS=4,t.PERFECT_LIMIT=10,t.SMALL_START_VALUE=0,t.SMALL_FROM_BRICK=8,t.SMALL_END_VALUE=33,t.SMALL_TO_BRICK=40,t.MEDIUM_START_VALUE=20,t.MEDIUM_FROM_BRICK=0,t.MEDIUM_END_VALUE=33,t.MEDIUM_TO_BRICK=30,t}();t.Gameplay=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(){function t(t,e,i){void 0===i&&(i=null),this.name="<no name>",this.debug=0,this._newFunction=null,this._count=0,this._pool=[],this._canGrow=!0,this._poolSize=0,this._classType=t,this._newFunction=i;for(var n=0;e>n;n++){var r=this.newItem();this._pool[this._count++]=r}this._poolSize=e}return t.prototype.createItem=function(){return 0===this._count?((this.debug&t.DEBUG_ALLOCATION)>0,this._canGrow?this.newItem():null):((this.debug&t.DEBUG_CREATE)>0,this._pool[--this._count])},t.prototype.destroyItem=function(e){(this.debug&t.DEBUG_DESTROY)>0,this._pool[this._count++]=e},Object.defineProperty(t.prototype,"newFunction",{set:function(t){this._newFunction=t},enumerable:!0,configurable:!0}),t.prototype.newItem=function(){return null!==this._newFunction?this._newFunction():new this._classType},Object.defineProperty(t.prototype,"canGrow",{set:function(t){this._canGrow=t},enumerable:!0,configurable:!0}),t.DEBUG_ALLOCATION=1,t.DEBUG_CREATE=2,t.DEBUG_DESTROY=4,t.DEBUG_ALL=7,t}();t.Pool=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(e,i,n,r,s){t.call(this,e,i,n,r),void 0!==s&&this.setAnchoredFrame(s)}return __extends(e,t),e.prototype.setAnchoredFrame=function(t){if("string"==typeof this.key){var e=null;"string"==typeof t?(this.frameName=t,e=this.game.cache.getFrameByName(this.key,t)):(this.frame=t,e=this.game.cache.getFrameByIndex(this.key,t)),void 0!==e.anchorX&&void 0!==e.anchorY&&this.anchor.setTo(e.anchorX,e.anchorY)}},e}(Phaser.Sprite);t.AnchoredSprite=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(e){t.call(this,e,0,0,"Background",0),this.anchor.set(0,0),this.fixedToCamera=!0,this.cameraOffset.set(0,0),this.resize()}return __extends(e,t),e.prototype.resize=function(){if(this.scale.set(1),this.width<this.game.width){var t=this.game.width/this.width;this.scale.set(t)}if(this.height<this.game.height){var t=this.game.height/this.height;this.scale.set(t)}},e}(Phaser.Sprite);t.Background=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(e){function i(n,r){e.call(this,n,r),this.onScore=new Phaser.Signal,this._firstBrick=null,this._currentBrick=null,this._recordedTower=[],this._hlpPt=new Phaser.Point,this._ruler=n.add.sprite(0,0,"Sprites","Ruler",this),this._ruler.tint=t.Gameplay.RULER_TINT,this._limitsPool=new t.Pool(t.Limit,4,function(){return new t.Limit(n)}),this._bricksPool=new t.Pool(t.Brick,i.BRICKS_MAX,function(){var e=new t.Brick(n);return e}),this._limitsGroup=new Phaser.Group(n,this),this._floor=new Phaser.Sprite(n,0,0,"Sprites","floor"),this._floor.anchor.set(.5,.5),this._floor.y=-this._floor.height/2,this.add(this._floor),this._bricksGroup=new Phaser.Group(n,this),this._bounceGroup=new Phaser.Group(n,this),this._physicsGroup=new Phaser.Group(n,this),this._hand=new t.Hand(n),this.add(this._hand),this.createEmitters(),this.calcDistances()}return __extends(i,e),i.prototype.render=function(){this._bricksGroup.forEach(function(t){t.render()},this)},i.prototype.onResize=function(e,i){this.calcDistances(),this._hand.recalcOffsetY(),null!==this._currentBrick?2===this._currentBrick.state?this.setCameraY():null!==this._currentBrick.prev&&(this._targetCameraY=Math.floor(this._currentBrick.prev.y-t.Gameplay.BRICK_SIZE.y/2-this._minHandDistance)):this._targetCameraY=0,this.game.camera.y=Math.min(-this.game.height,this._targetCameraY),this._targetCameraY=this.game.camera.y,this._floorY=-t.Gameplay.FLOOR_HEIGHT-t.Gameplay.BRICK_SIZE.y/2;for(var n=this._firstBrick,r=this._floorY;null!==n;)n.y=r,n.height=t.Gameplay.BRICK_SIZE.y,r-=t.Gameplay.BRICK_SIZE.y,n=n.next},i.prototype.calcDistances=function(){this._minHandDistance=Math.floor(this.game.height*t.Gameplay.MIN_HAND_RATIO),t.Gameplay.BRICK_SIZE.y=(this.game.height-this._minHandDistance)/t.Gameplay.BRICKS_VISIBLE,this._floorY=-t.Gameplay.FLOOR_HEIGHT-t.Gameplay.BRICK_SIZE.y/2},i.prototype.createEmitters=function(){var e=new Particles.ParticlesEmitter(this.game,0,0,12);e.particleClass=t.ImpactRectParticle,e.makeParticles("Sprites","ImpactParticle",12),e.lifetime=.5,e.setAngle(0,0),e.setAlpha(.25,.25),this._impactRectEmitter=e,this.add(e),e=new Particles.ParticlesEmitter(this.game,0,0,32),e.makeParticles("Sprites","ImpactParticle",32),e.area=new Phaser.Line(0,0,100,100),e.lifetime=.5,e.setYSpeed(-200,0),e.setXSpeed(-250,250),e.setAngle(0,360),
e.gravity=600,e.setAlpha(1,1),e.setScale(.5,1),e.setAlphaChange(Particles.eParameterChangeType.IN_TIME,-1,.5),e.setScaleChange(Particles.eParameterChangeType.IN_TIME,-1,.5),this._impactEmitter=e,this.add(e),e=new Particles.ParticlesEmitter(this.game,0,0,8),e.makeParticles("Sprites",["ptcPerfect","ptcNice","ptcWellDone"],8),e.lifetime=4.5,e.setYSpeed(-750,-750),e.setXSpeed(-80,-80),e.setAngularSpeed(-15,15),e.gravity=1600,this._messageEmitter=e,this.add(e),e=new Particles.ParticlesEmitter(this.game,0,0,64),e.makeParticles("Sprites","StarParticle",64),e.area=new Phaser.Line(0,0,100,100),e.lifetime=1.5,e.setYSpeed(-350,30),e.setXSpeed(-350,350),e.setAngle(0,360),e.setAngularSpeed(-90,90),e.gravity=600,e.setAlpha(1,1),e.setScale(.5,1),e.setAlphaChange(Particles.eParameterChangeType.IN_TIME,-1,1.5),e.setScaleChange(Particles.eParameterChangeType.IN_TIME,1,1.5),this._perfectEmitter=e,this.add(e),e=new Particles.ParticlesEmitter(this.game,0,0,4),e.particleClass=t.ScoreParticle,e.makeParticles("Game",null,4),e.setXSpeed(-50,50),e.setYSpeed(-600,-600),e.setAngularSpeed(-45,45),e.lifetime=1,e.gravity=1200,e.setAlpha(2.5,2.5),e.setAlphaChange(Particles.eParameterChangeType.IN_TIME,-2.6,1),this._scoreEmitter=e,this.add(e)},i.prototype.reset=function(){this.game.camera.setPosition(-this.game.width/2,-this.game.height),this._targetCameraY=this.game.camera.y,this._cameraMoveType=1,this._cameraSpeed=300,this.returnAllFromGroupToPool(this._limitsGroup,this._limitsPool),this.returnAllFromGroupToPool(this._bricksGroup,this._bricksPool),this.returnAllFromGroupToPool(this._bounceGroup,this._bricksPool),this.returnAllFromGroupToPool(this._physicsGroup,this._bricksPool),this._weakestBrick=null,this._destroyWeakestBody=!1,this._hand.resetHand(),this._bricksCount=0,this._bouncing=!1,this._perfectInRow=0,this._scoreMultiplier=1,this._currentBrick=null,this.putInitialBricks(),this._recordedTower=[],this._recodredTowerTop=0,this._state=0,this.updateLimits()},i.prototype.putInitialBricks=function(){for(var e=new Helper.RandomBooleanBalancer(this.game.rnd,2),i=this._floorY,n=0;n<t.Gameplay.INITIAL_BRICKS;n++){var r=this.getNextBrick();r.width=t.Gameplay.BRICK_SIZE.x/4*(3+(e.getBoolean()?1:0)),r.prev=this._currentBrick,null!==this._currentBrick?this._currentBrick.next=r:this._firstBrick=r,this._currentBrick=r;var s=Math.floor(.15*t.Gameplay.BRICK_SIZE.x);r.x=this.game.rnd.integerInRange(-s,s),r.y=i,r.baseX=r.x-this.getSideMoveSin()*this.getSideMoveAmpForY(r.y),this._recordedTower[this._bricksCount]=r.compressedData,++this._bricksCount,i-=t.Gameplay.BRICK_SIZE.y}},i.prototype.returnAllFromGroupToPool=function(t,e){for(var i=t.length-1;i>=0;i--){var n=t.getChildAt(i);e.destroyItem(n),t.remove(n)}},i.prototype.getNextBrick=function(){var t=this._bricksPool.createItem();return null!==t&&(t.resetBrick(this.getBrickSize()),this._bricksGroup.add(t)),t},i.prototype.getBrickSize=function(){var e=this._bricksCount,i=0;e>=t.Gameplay.SMALL_FROM_BRICK&&(i=Phaser.Math.mapLinear(Phaser.Math.clamp(e,t.Gameplay.SMALL_FROM_BRICK,t.Gameplay.SMALL_TO_BRICK),t.Gameplay.SMALL_FROM_BRICK,t.Gameplay.SMALL_TO_BRICK,t.Gameplay.SMALL_START_VALUE,t.Gameplay.SMALL_END_VALUE));var n=0;e>=t.Gameplay.MEDIUM_FROM_BRICK&&(n=Phaser.Math.mapLinear(Phaser.Math.clamp(e,t.Gameplay.MEDIUM_FROM_BRICK,t.Gameplay.MEDIUM_TO_BRICK),t.Gameplay.MEDIUM_FROM_BRICK,t.Gameplay.MEDIUM_TO_BRICK,t.Gameplay.MEDIUM_START_VALUE,t.Gameplay.MEDIUM_END_VALUE)),n+=i;var r=this.game.rnd.realInRange(0,100);return i>r?2:n>r?3:4},i.prototype.attachNewBrick=function(t){var e=this.getNextBrick();return e.prev=t,null!==t&&(t.next=e),this._hand.attachBrick(e),e},i.prototype.handleInput=function(){var t=this._currentBrick;null!==t&&0===t.state&&(this._hand.dropBrick(),t.state=1,t.x=Math.round(t.x))},i.prototype.updateBoard=function(){var e=!0,i=this.game.time.elapsedMS/1e3,n=this._currentBrick;switch(this._hand.updateHand(),this._state){case 0:this._currentBrick=this.attachNewBrick(n),this._state=1;break;case 1:null!==n&&this.updateBrickFall(i,n);break;case 2:if(!this.updateCamera(i)){for(;this._firstBrick.y-t.Gameplay.BRICK_SIZE.y/2>this.game.camera.y+this.game.height;){var r=this._firstBrick;this._firstBrick=r.next,this._firstBrick.prev=null,this._bricksPool.destroyItem(r)}this._state=0}break;case 3:this._bouncing||(this.dismissBounceGroup(),this.returnAllFromGroupToPool(this._bricksGroup,this._bricksPool),this._targetCameraY=-this.game.height,this._cameraMoveType=1,this._cameraSpeed=-this.game.camera.y/this.game.height*150,this.updateRecordTower(),this._waitCounter=1*t.Gameplay.GAME_OVER_WAIT_TIME,this._state=4);break;case 4:(this._waitCounter-=i)<=0&&(this._state=5,this.game.time.events.add(150,function(){Utils.AudioUtils.playSound("game_over")},this),this._destroyWeakestBody&&(this.game.physics.p2.removeBody(this._weakestBrick.body),this._weakestBrick.body=null));break;case 5:this.updateCamera(i)||(this._state=6),this.updateRecordTower();break;case 6:e=!1}return this.updateSideMove(),this.updateLimits(),e},i.prototype.updateSideMove=function(){for(var t=this.getSideMoveSin(),e=0;e<this._bricksGroup.length;e++){var i=this._bricksGroup.getAt(e);if(2===i.state){var n=this.getSideMoveAmpForY(i.y);i.x=i.baseX+n*t}}null!==this._weakestBrick&&null!==this._weakestBrick.body&&(this._weakestBrick.body.x=this._weakestBrick.baseX+this.getSideMoveAmpForY(this._weakestBrick.y)*t)},i.prototype.getSideMoveSin=function(){if(!t.Gameplay.MOVE_TOWER)return 0;var e=this.game.time.time/500;return Math.sin(e)},i.prototype.getSideMoveAmpForY=function(e){var i=(e-this._floorY+3*t.Gameplay.BRICK_SIZE.y)/(4*t.Gameplay.BRICK_SIZE.y);return Math.max(Math.min(0,i),-25)},i.prototype.updateBrickFall=function(e,n){if(n.updateBrick(e,Math.max(this._floorY,this.game.camera.y+t.Gameplay.BRICK_SIZE.y/2)),n.landed){var r=!1;if(n.baseX=n.x-this.getSideMoveSin()*this.getSideMoveAmpForY(n.y),null!==n.prev&&n.y>=n.prev.y){this._bouncing=!1,this._hand.freeze=!0,this._recodredTowerTop=this._bricksCount+1,this._bounceGroup.add(n);var s=this._firstBrick;for(this._weakestBrick=s;null!==s&&s.y>n.y;)s.y-n.y>5&&s.y<this._weakestBrick.y&&(this._weakestBrick=s),s=s.next;return s=this._weakestBrick,null!==this._weakestBrick&&(s.x-s.width/2-(n.x-n.width/2)>n.width/2?this._destroyWeakestBody=!1:n.x+n.width/2-(s.x+s.width/2)>n.width/2?this._destroyWeakestBody=!1:this._destroyWeakestBody=!0),Utils.AudioUtils.playSoundRnd(i.SFX_MISS),this._state=3,!1}if(!this.checkBalance())return this._hand.freeze=!0,this.addToBounceGroup(),this._state=3,Utils.AudioUtils.playSoundRnd(i.SFX_MISS),!1;this._recordedTower[this._bricksCount]=n.compressedData,++this._bricksCount,this._hand.setSpeedMultiplier(t.Gameplay.INITIAL_HAND_MULTIPLIER+this._bricksCount*t.Gameplay.ADD_HAND_SPEED_BRICK,this._bricksCount-(t.Gameplay.INITIAL_BRICKS-1)),n.y-this.game.camera.y<this._minHandDistance?(this.setCameraY(),this._state=2):this._state=0,null!==n.prev&&(Math.abs(n.x-n.prev.x)<t.Gameplay.PERFECT_LIMIT?(r=!0,++this._perfectInRow>=2&&(this._messageEmitter.emitAt(n.x,n.y-40),this._messageEmitter.emitParticle()),this._perfectInRow>=3?Utils.AudioUtils.playSoundRnd(i.SFX_SUPER):Utils.AudioUtils.playSoundRnd(i.SFX_PERFECT)):(this._perfectInRow=0,Utils.AudioUtils.playSoundRnd(i.SFX_NORMAL))),this._bricksCount-1===10?this._scoreMultiplier=2:this._bricksCount-1===30?this._scoreMultiplier=3:this._bricksCount-1>0&&(this._bricksCount-1)%50===0?this._scoreMultiplier=5:r||(this._scoreMultiplier=1);var a=(1+Math.min(this._perfectInRow,4))*this._scoreMultiplier;this.onScore.dispatch(a),this._scoreEmitter.emitAt(n.x,n.y);var o=this._scoreEmitter.emitParticle();null!==o&&(o.text=a),null===this._firstBrick&&(this._firstBrick=n,Utils.AudioUtils.playSoundRnd(i.SFX_NORMAL)),this.emitImpactParticles(n,r)}return!0},i.prototype.checkBalance=function(){var t=!0,e=this._currentBrick;this._weakestBrick=null;for(var i=-1;null!==e;)e.checkBallance()||((null===this._weakestBrick||e.getBalanceRatio()>this._weakestBrick.getBalanceRatio())&&(this._weakestBrick=e,this._recodredTowerTop=this._bricksCount-i),0!==this._weakestBrick.weakSide&&(t=!1)),++i,e=e.prev;return t},i.prototype.updateCamera=function(t){if(this.game.camera.y!==this._targetCameraY){var e=this._targetCameraY-this.game.camera.y,i=Phaser.Math.sign(e),n=0;return 0===this._cameraMoveType?n=Math.min(Math.abs(e),Math.abs(i*t*this._cameraSpeed)):1===this._cameraMoveType&&(n=Math.min(Math.abs(e),Math.abs((this._targetCameraY-this.game.camera.y)*t*this._cameraSpeed/45)),n=Math.min(n,1e3*t)),this.game.camera.y+=i*Math.max(n,1),!0}return!1},i.prototype.setCameraY=function(){this._targetCameraY=Math.floor(this._currentBrick.y-t.Gameplay.BRICK_SIZE.y/2-this._minHandDistance)},i.prototype.updateRecordTower=function(){var e=this.getSideMoveSin(),i=this.game.camera.y,n=i+this.game.height;i-=t.Gameplay.BRICK_SIZE.y/2,n+=t.Gameplay.BRICK_SIZE.y/2,this.returnAllFromGroupToPool(this._bricksGroup,this._bricksPool),this.returnAllFromGroupToPool(this._limitsGroup,this._limitsPool);var r=-Math.floor((n+t.Gameplay.FLOOR_HEIGHT)/t.Gameplay.BRICK_SIZE.y);for(0>r&&(r=0);r<this._recodredTowerTop-1;){var s=-(r*t.Gameplay.BRICK_SIZE.y+t.Gameplay.FLOOR_HEIGHT+t.Gameplay.BRICK_SIZE.y/2);if(i>s)break;var a=this._bricksPool.createItem();if(null!==a&&(a.compressedData=this._recordedTower[r],a.y=s,a.x+=e*this.getSideMoveAmpForY(a.y),this._bricksGroup.add(a)),r>0&&r%10===0){var o=this._limitsPool.createItem();null!==o&&(o.position.set(20,s),o.value=r/10,this._limitsGroup.add(o))}++r}},i.prototype.updateLimits=function(){var e=this.game.camera.y,i=e+this.game.height;e-=t.Gameplay.BRICK_SIZE.y/2,i+=t.Gameplay.BRICK_SIZE.y/2,this.returnAllFromGroupToPool(this._limitsGroup,this._limitsPool),this._ruler.position.set(-this.game.width/2+20,e),this._ruler.height=i-e;var n=t.Gameplay.RULER_STEP*t.Gameplay.BRICK_SIZE.y,r=i+t.Gameplay.FLOOR_HEIGHT;for(r=Math.floor(r/n)*n-t.Gameplay.FLOOR_HEIGHT;r>e;){var s=-((r+t.Gameplay.FLOOR_HEIGHT)/n)*t.Gameplay.RULER_STEP;if(s>0){var a=this._limitsPool.createItem();null!==a&&(a.position.set(-this.game.width/2+20,r),a.value=s,this._limitsGroup.add(a))}r-=n}},i.prototype.addToBounceGroup=function(){var e=this._weakestBrick,i=this._weakestBrick.weakSide;0===i&&(i=1),this._bounceGroup.position.set(e.x+(1===i?-e.width/2:e.width/2),e.y-t.Gameplay.BRICK_SIZE.y/2);var n=this._hlpPt;for(n.set(this._bounceGroup.x-this._bricksGroup.x,this._bounceGroup.y-this._bricksGroup.y),e=e.next;null!==e;)this._bounceGroup.add(e),e.position.set(e.x-n.x,e.y-n.y),e=e.next;this._bouncing=!0,this.game.add.tween(this._bounceGroup).to({angle:1===i?-0:0},10,Phaser.Easing.Quadratic.In,!0,0).onComplete.add(function(){this._bouncing=!1},this)},i.prototype.dismissBounceGroup=function(){var e=this.game.physics.p2.createMaterial("material"),i=this.game.physics.p2.createContactMaterial(e,e);i.friction=.95,i.restitution=0,i.stiffness=1e7,i.relaxation=3,i.frictionStiffness=1e7,i.frictionRelaxation=1,i.surfaceVelocity=0;var n=this.game.physics.p2.createCollisionGroup(),r=this.game.physics.p2.createCollisionGroup(),s=[n,r],a=this._hlpPt;a.set(this._bounceGroup.x-this._bricksGroup.x,this._bounceGroup.y-this._bricksGroup.y);var o=this._weakestBrick,h=this._weakestBrick.weakSide;this.setBrickBody(o,e,r,s);var p=o.body;p.kinematic=!0,this._physicsGroup.add(o);for(var l=this._bounceGroup.length-1;l>=0;l--){var c=this._bounceGroup.getAt(l);c.y;c.rotation=this._bounceGroup.rotation,this._physicsGroup.add(c),c.position.set(c.x+a.x,c.y+a.y),c.position.rotate(a.x,a.y,this._bounceGroup.rotation),this.setBrickBody(c,e,r,s);var u=c.body;u.rotation=this._bounceGroup.rotation,u.data.velocity[1]=-10,u.applyImpulseLocal([1===h?20:-20,0],(1===h?-1:1)*o.width/2,t.Gameplay.BRICK_SIZE.y/2)}},i.prototype.setBrickBody=function(t,e,i,n){this.game.physics.p2.enable(t,!1);var r=t.body;r.mass=5,r.clearShapes(),r.allowSleep=!0,r.sleepSpeedLimit=1,r.damping=.2,r.addRectangle(t.width,t.height),r.setCollisionGroup(i),r.collides(n),r.setMaterial(e)},i.prototype.emitImpactParticles=function(e,i){var n=i?this._perfectEmitter:this._impactEmitter,r=n.params.area,s=null===e.prev?e.x-e.width/2:Math.max(e.x-e.width/2,e.prev.x-e.prev.width/2),a=null===e.prev?e.x+e.width/2:Math.min(e.x+e.width/2,e.prev.x+e.prev.width/2),o=e.y+t.Gameplay.BRICK_SIZE.y/2;r.setTo(s,o,a,o);var h=(a-s)/2,p=s+h,l=n.params.maxSpeedX/h,c=Math.floor((a-s)/10);i&&(c=32),n.explode(c,function(t){t._velocity.x=(t.visual.x-p)*l},this),this._impactRectEmitter.emitAt(e.x,e.y);for(var u=0;2>u;u++){var _=this._impactRectEmitter.emitParticle();if(null!==_){_.delay=.15*u,_.on=!0;var d=_.visual;d.width=e.width,d.height=e.height,_.setScaleChange(Particles.eParameterChangeType.IN_TIME,30),_.setAlphaChange(Particles.eParameterChangeType.IN_TIME,-.4)}}},i.SFX_MISS=["miss_1","miss_2"],i.SFX_NORMAL=["normal_1","normal_2"],i.SFX_PERFECT=["perfect_1","perfect_2"],i.SFX_SUPER=["super_1","super_2"],i.BRICKS_MAX=24,i}(Phaser.Group);t.Board=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(e){function i(t){e.call(this,t,0,0,"Sprites"),this._balance=[0,0,0],this.anchor.set(.5,.5),this.scale.set(1)}return __extends(i,e),i.prototype.render=function(){for(var t="",e=0;3>e;e++)t+=this._balance[e].toFixed(2),2!==e&&(t+=" / ");this.game.debug.text(t,this.x+this.game.width/2-90,this.y-this.game.camera.y,"RGB(255, 0, 0)")},i.getRandomBrickColor=function(){if(i.BRICK_COLORS_INDEX>=i.BRICK_COLORS.length){var t=i.BRICK_COLORS[i.BRICK_COLORS.length-1];do Phaser.ArrayUtils.shuffle(i.BRICK_COLORS);while(i.BRICK_COLORS[0]===t);i.BRICK_COLORS_INDEX=0}return i.BRICK_COLORS[i.BRICK_COLORS_INDEX++]},Object.defineProperty(i.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"next",{get:function(){return this._next},set:function(t){this._next=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"prev",{get:function(){return this._prev},set:function(t){this._prev=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"landed",{get:function(){var t=this._landed;return this._landed=!1,t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"baseX",{get:function(){return this._baseX},set:function(t){this._baseX=t},enumerable:!0,configurable:!0}),i.prototype.resetBrick=function(e){this.frameName=i.getRandomBrickColor(),this.width=t.Gameplay.BRICK_SIZE.x/4*e,this.height=t.Gameplay.BRICK_SIZE.y,this._state=0,this._next=null,this._prev=null,this._velY=0,this._landed=!1,this._balance[0]=this._balance[1]=this._balance[2]=0},i.prototype.updateBrick=function(e,i){if(1===this._state){e=Math.min(e,.05),this._velY+=t.Gameplay.GRAVITY*e,this.y+=this._velY*e;var n=!1;if(this.y>=i)this.y=i,n=!0;else for(var r=this._prev;null!==r;){if(Math.abs(this.y-r.y)<t.Gameplay.BRICK_SIZE.y&&this.x+this.width/2>r.x-r.width/2&&this.x-this.width/2<r.x+r.width/2){this.y=r.y-t.Gameplay.BRICK_SIZE.y,n=!0;break}r=r._prev}n&&this.brickLanded()}},i.prototype.brickLanded=function(){this._state=2,this._landed=!0},i.prototype.checkBallance=function(){var t=!0,e=0;this._balance[0]=this._balance[1]=this._balance[2]=0;for(var i=this._next;null!==i;){++e;var n=Math.max(0,this.x-this.width/2-(i.x-i.width/2)),r=Math.max(0,i.x+i.width/2-(this.x+this.width/2)),s=i.width-n-r;this._balance[0]+=n,this._balance[1]+=s,this._balance[2]+=r,(this._balance[0]>this._balance[1]+this._balance[2]||this._balance[2]>this._balance[0]+this._balance[1])&&(t=!1),i=i._next}return t},i.prototype.getBalanceRatio=function(){var t=this._balance[0],e=this._balance[1],i=this._balance[2];return t>e+i?t/(e+i):i>t+e?i/(t+e):1},Object.defineProperty(i.prototype,"weakSide",{get:function(){var t=this._balance[0],e=this._balance[1],i=this._balance[2];return t>e+i?1:i>t+e?2:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"compressedData",{get:function(){var t=Math.floor(this._baseX)+this.game.width/2,e=this.width,i=this.frame;return t+(e<<16)+(i<<24)},set:function(e){this._baseX=(65535&e)-this.game.width/2,this.width=e>>16&255,this.frame=e>>24&255,this.height=t.Gameplay.BRICK_SIZE.y,this.x=this._baseX},enumerable:!0,configurable:!0}),i.BRICK_COLORS=["block_blue","block_green","block_lightblue","block_orange","block_red","block_white","block_yellow"],i.BRICK_COLORS_INDEX=Number.MAX_VALUE,i}(Phaser.Sprite);t.Brick=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(e){function i(i){e.call(this,i),this._brick=null,this._speedTime=0,this._speedMultiplierBase=1,this._speedMultiplierAdd=1,this._direction=1,this._time=0,this._shadow=i.add.sprite(0,0,"Sprites","rukaShadow",this),this._shadow.anchor.set(.38,.1),this._hand=i.add.sprite(0,0,"Sprites","ruka",this),this._hand.anchor.set(.38,.1),this._elipseAFinal=this.game.width/2-t.Gameplay.BRICK_SIZE.x/2-10,this._elipseBFinal=t.Gameplay.BRICK_SIZE.y,this._shadow.exists=!1,this._offsetY=0}return __extends(i,e),i.prototype.setSpeedMultiplier=function(e,i){this._speedMultiplierBase=e,this._speedMultiplierAdd=0,this._speedTime=0;var n=Math.log(10*i/t.Gameplay.BRICKS_TO_FULL_HAND_RANGE+.5)/Math.LN10;this._elipseATarget=Math.min(n,1)*this._elipseAFinal,this._elipseBTarget=Math.min(n,1)*this._elipseBFinal},i.prototype.resetHand=function(){this._time=0,this.setSpeedMultiplier(t.Gameplay.INITIAL_HAND_MULTIPLIER,1),this._elipseA=0,this._elipseB=0,this.randomizeDirection(),this.recalcOffsetY(),this.position.x=0,this.position.y=this.game.camera.y-this._offsetY-t.Gameplay.BRICK_SIZE.y+this._elipseB*Math.sin(1.66666*this._time),this._brick=null,this._freeze=!1},i.prototype.recalcOffsetY=function(){this._offsetY=100*Phaser.Math.clamp(1152/this.game.height-1,0,1)},i.prototype.randomizeDirection=function(){this._direction=this.game.rnd.sign()},i.prototype.attachBrick=function(t){this._brick=t,this.setBrickPosition(),this._shadow.exists=!0},i.prototype.dettachBrick=function(){var t=this._brick;return this._brick=null,this._shadow.exists=!1,t},Object.defineProperty(i.prototype,"freeze",{set:function(t){this._freeze=t},enumerable:!0,configurable:!0}),i.prototype.updateHand=function(){this._freeze||this.move()},i.prototype.dropBrick=function(){this.dettachBrick()},i.prototype.move=function(){var e=this.game.time.elapsedMS/1e3;this._elipseA!==this._elipseATarget&&(this._elipseA=Phaser.Math.linear(this._elipseA,this._elipseATarget,e)),this._elipseB!==this._elipseBTarget&&(this._elipseB=Phaser.Math.linear(this._elipseB,this._elipseBTarget,e)),this._time+=e*(this._speedMultiplierBase+this._speedMultiplierAdd),this._speedTime+=e,this._speedMultiplierAdd=Math.min(10,this._speedTime/Math.PI),this.x=this._elipseA*Math.sin(this._time),this.y=this.game.camera.y-this._offsetY-t.Gameplay.BRICK_SIZE.y+this._elipseB*Math.sin(1.66666*this._time),null!==this._brick&&this.setBrickPosition()},i.prototype.setBrickPosition=function(){this._brick.position.set(this.x+i.BRICK_OFFSET.x,this.y+i.BRICK_OFFSET.y)},i.BRICK_OFFSET=new Phaser.Point(0,197),i}(Phaser.Group);t.Hand=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.update=function(e){if(void 0===e&&(e=!0),!t.prototype.update.call(this,!1))return!1;var i=this._game.time.physicsElapsed;if(this._delay<=0){if(this._scaleChangeType!=Particles.eParameterChangeType.NO_CHANGE)switch(this._scaleChangeType){case Particles.eParameterChangeType.IN_TIME:(this._visual.scale.x+=this._scaleChange*i)<0&&(this._visual.scale.x=0,this._scaleChange<0&&(this._scaleChangeType=Particles.eParameterChangeType.NO_CHANGE)),(this._visual.scale.y+=this._scaleChange*i/5)<0&&(this._visual.scale.y=0,this._scaleChange<0&&(this._scaleChangeType=Particles.eParameterChangeType.NO_CHANGE))}if(this._alphaChangeType!=Particles.eParameterChangeType.NO_CHANGE)switch(this._alphaChangeType){case Particles.eParameterChangeType.IN_TIME:this._alpha+=this._alphaChange*i,this._alpha<0?(this._visual.alpha=0,this._alphaChange<0&&(this._alphaChangeType=Particles.eParameterChangeType.NO_CHANGE)):this._alpha>1?(this._visual.alpha=1,this._alphaChange>0&&(this._alphaChangeType=Particles.eParameterChangeType.NO_CHANGE)):this._visual.alpha=this._alpha}}return!0},e}(Particles.SpriteParticle);t.ImpactRectParticle=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(e){function i(i){e.call(this,i,null),this._tick=i.add.sprite(0,0,"Sprites","RulerTick",this),this._tick.anchor.y=.5,this._tick.tint=t.Gameplay.RULER_TINT,this._label=new Phaser.BitmapText(i,25,0,"Font","",32,"left"),this._label.anchor.y=.5,this._label.tint=t.Gameplay.RULER_TINT,this.add(this._label),this._limit=i.add.sprite(60,0,"Sprites","RulerLimit",this),this._limit.anchor.y=.5,this._limit.tint=t.Gameplay.RULER_TINT}return __extends(i,e),Object.defineProperty(i.prototype,"value",{set:function(t){this._label.text=""+t,10===t||30===t||t%50===0?(this._tick.scale.set(1,2),this._limit.visible=!0,this._limit.x=25+this._label.width+8):(this._tick.scale.set(1,1),this._limit.visible=!1)},enumerable:!0,configurable:!0}),i}(Phaser.Group);t.Limit=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(e){t.call(this,e,0,0,"Sprites"),this._cropRect=new Phaser.Rectangle(0,0,0,0),this._time=0,this._width=0,this.anchor.set(.5),this.crop(this._cropRect,!1),this.exists=!1}return __extends(e,t),e.prototype.show=function(){this.frameName=e.MESSAGES[this.game.rnd.integerInRange(0,e.MESSAGES.length-1)];var t=this.game.cache.getFrameByName("Sprites",this.frameName);this._width=t.width,this._time=0,this._cropRect.setTo(0,0,0,t.height),this.updateCrop(),this.exists=!0},e.prototype.updateMessage=function(){this._time=Phaser.Math.clamp(this._time+this.game.time.elapsedMS,0,e.DURATION);var t=this._time/e.DURATION,i=this._width;t<e.INIT_TIME_PERCENT?i=this._width*t/e.INIT_TIME_PERCENT:t>1-e.INIT_TIME_PERCENT&&(i=this._width*(1-t)/e.INIT_TIME_PERCENT),this._cropRect.width=i,this.updateCrop(),1===t&&(this.exists=!1)},e.MESSAGES=["ptcPerfect","ptcNice","ptcWellDone"],e.DURATION=1e3,e.INIT_TIME_PERCENT=.2,e}(Phaser.Sprite);t.Message=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.onCreate=function(){var t=new Phaser.BitmapText(this._game,0,0,"Font2","",e.FONT_SIZE,"center");t.anchor.setTo(.5,.5),this._visual=t,this._text=t},Object.defineProperty(e.prototype,"text",{set:function(t){this._text.text="+"+t},enumerable:!0,configurable:!0}),e.FONT_SIZE=50,e}(Particles.Particle);t.ScoreParticle=e}(BlockBusters||(BlockBusters={}));var Spriter;!function(t){var e=function(){function t(){this._items=[],this._itemNames=[]}return t.prototype.add=function(t,e,i){void 0===e&&(e=this._items.length),(void 0===i||null===i)&&(i="item_"+e),this._items[e]=t,this._itemNames[i]=e},t.prototype.getById=function(t){return this._items[t]},t.prototype.getByName=function(t){var e=this._itemNames[t];return"number"==typeof e?this._items[e]:null},Object.defineProperty(t.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0}),t}();t.IdNameMap=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(){this.reset()}return Object.defineProperty(t.prototype,"current",{get:function(){return this._line.at(this._currentIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentIndex",{get:function(){return this._currentIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"next",{get:function(){return this._line.at(this._nextIndex)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextIndex",{get:function(){return this._nextIndex},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastTime",{set:function(t){this._lastTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"line",{get:function(){return this._line},set:function(t){this._line=t},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this._lastTime=-1,this._currentIndex=-1,this._nextIndex=0},t.prototype.step=function(t){var e=this._nextIndex,i=this._line.keys[e],n=i.time,r=t<this._lastTime;return!r&&n>this._lastTime&&t>=n||r&&(n>this._lastTime||t>=n)?(this._lastTime=n,this._currentIndex=e,++e>=this._line.keys.length&&(e=0),this._nextIndex=e,i):null},t}();t.LineStepper=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function e(){}return e.prototype.load=function(e){this._spriter=new t.Spriter,this._fileType=e.getType();var i=e.getNodes("folder");this.loadFolders(this._spriter,i),i.processed();var n=e.getNodes("tag_list");this.loadTags(this._spriter,n),n.processed();var r=e.getNodes("entity");return this.loadEntities(this._spriter,r),r.processed(),this._spriter},e.prototype.loadFolders=function(t,e){for(var i=0;i<e.length();i++){var n=e.getFolder(i),r=e.getChildNodes(i,"file");this.loadFiles(n,r),r.processed(),t.addFolder(n)}},e.prototype.loadFiles=function(t,e){for(var i=0;i<e.length();i++){var n=e.getFile(i);null!==n&&t.addFile(n)}},e.prototype.loadTags=function(e,i){if(0!==i.length()){var n;n=this._fileType!==t.eFileType.JSON?i.getChildNodes(0,"i"):i;for(var r=0;r<n.length();r++){var s=n.getTag(r);e.addTag(s)}this._fileType!==t.eFileType.JSON&&n.processed()}},e.prototype.loadEntities=function(t,e){for(var i=0;i<e.length();i++){var n=e.getEntity(i),r=e.getChildNodes(i,"obj_info");this.loadObjInfo(n,r),r.processed();var s=e.getChildNodes(i,"character_map");this.loadCharMaps(n,s),s.processed();var a=e.getChildNodes(i,"var_defs");this.loadVariables(n,a),a.processed();var o=e.getChildNodes(i,"animation");this.loadAnimations(n,o),o.processed(),t.addEntity(n)}},e.prototype.loadObjInfo=function(t,e){for(var i=0;i<e.length();i++){var n=e.getObjectInfo(i);t.addObjectInfo(n)}},e.prototype.loadCharMaps=function(t,e){for(var i=0;i<e.length();i++){var n=e.getCharMap(i),r=e.getChildNodes(i,"map");this.loadCharMapEntries(n,r),r.processed(),t.addCharMap(n)}},e.prototype.loadCharMapEntries=function(t,e){for(var i=0;i<e.length();i++)e.getCharMapEntry(i,t,this._spriter)},e.prototype.loadVariables=function(e,i){if(0!==i.length()){var n;n=this._fileType!==t.eFileType.JSON?i.getChildNodes(0,"i"):i;for(var r=0;r<n.length();r++){var s=n.getVariable(r);e.addVariable(s)}this._fileType!==t.eFileType.JSON&&n.processed()}},e.prototype.loadAnimations=function(e,i){for(var n=0;n<i.length();n++){var r=i.getAnimation(n),s=i.getChildNodes(n,"mainline");this.loadMainline(r,s),s.processed();var a=i.getChildNodes(n,"timeline");this.loadTimelines(r,a),a.processed();var o=i.getChildNodes(n,"soundline");this.loadSoundlines(r,o),o.processed();var h=i.getChildNodes(n,"eventline");this.loadEventlines(r,h),h.processed();var p=i.getChildNodes(n,"meta");if(p.length()>0){var l=p.getChildNodes(0,this._fileType!==t.eFileType.JSON?"varline":"valline");this.loadVarlines(e,r,l),l.processed();var c=p.getChildNodes(0,"tagline");this.loadTaglines(r,c),c.processed()}p.processed(),e.addAnimation(r)}},e.prototype.loadMainline=function(e,i){var n=i.getMainline(0);n.type=t.eTimelineType.MAIN_LINE;var r=i.getChildNodes(0,"key");this.loadMainlineKeys(n,r),r.processed(),e.mainline=n},e.prototype.loadMainlineKeys=function(t,e){for(var i=0;i<e.length();i++){for(var n=e.getMainlineKey(i),r=e.getChildNodes(i,"bone_ref"),s=0;s<r.length();s++)n.addBoneRef(r.getRef(s));r.processed();for(var a=e.getChildNodes(i,"object_ref"),o=0;o<a.length();o++)n.addObjectRef(a.getRef(o));a.processed(),t.add(n)}},e.prototype.loadTimelines=function(t,e){for(var i=0;i<e.length();i++){var n=e.getTimeline(i),r=e.getChildNodes(i,"key");this.loadTimelineKeys(n,r),r.processed(),t.addTimeline(n)}},e.prototype.loadTimelineKeys=function(t,e){for(var i=0;i<e.length();i++){var n=e.getTimelineKey(i,this._spriter);t.add(n)}},e.prototype.loadSoundlines=function(e,i){for(var n=0;n<i.length();n++){var r=i.getSoundline(n);r.type=t.eTimelineType.SOUND_LINE;var s=i.getChildNodes(n,"key");this.loadKeys(r,s),s.processed(),e.addLine(r)}},e.prototype.loadKeys=function(t,e){for(var i=0;i<e.length();i++){var n=e.getKey(i);t.add(n)}},e.prototype.loadEventlines=function(e,i){for(var n=0;n<i.length();n++){var r=i.getEventline(n);r.type=t.eTimelineType.EVENT_LINE;var s=i.getChildNodes(n,"key");this.loadKeys(r,s),s.processed(),e.addLine(r)}},e.prototype.loadTaglines=function(e,i){for(var n=0;n<i.length();n++){var r=i.getTagline(n);r.type=t.eTimelineType.TAG_LINE;var s=i.getChildNodes(n,"key");this.loadTagKeys(r,s),s.processed(),e.addLine(r)}},e.prototype.loadTagKeys=function(t,e){for(var i=0;i<e.length();i++){var n=e.getTagKey(i),r=e.getChildNodes(i,"tag"),s=r.getTagChanges(this._spriter);r.processed(),n.tagsOn=s,t.add(n)}},e.prototype.loadVarlines=function(t,e,i){for(var n=0;n<i.length();n++){var r=i.getVarline(n),s=t.getVariableById(r.varDefId).type,a=i.getChildNodes(n,"key");this.loadVariableKeys(r,a,s),a.processed(),e.addLine(r)}},e.prototype.loadVariableKeys=function(t,e,i){for(var n=0;n<e.length();n++){var r=e.getVariableKey(n,i);t.add(r)}},e}();t.Loader=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t,e){this._file=t,this._nodeList=e}return t.prototype.length=function(){return this._nodeList.length},t.prototype.processed=function(){this._file.processed()},t.prototype.getChildNodes=function(t,e){return this._file.getNodesForElement(this._nodeList[t],e)},t.prototype.getFolder=function(t){return this._file.getFolder(this._nodeList[t])},t.prototype.getFile=function(t){return this._file.getFile(this._nodeList[t])},t.prototype.getTag=function(t){return this._file.getTag(this._nodeList[t])},t.prototype.getEntity=function(t){return this._file.getEntity(this._nodeList[t])},t.prototype.getObjectInfo=function(t){return this._file.getObjectInfo(this._nodeList[t],t)},t.prototype.getCharMap=function(t){return this._file.getCharMap(this._nodeList[t])},t.prototype.getCharMapEntry=function(t,e,i){this._file.getCharMapEntry(this._nodeList[t],e,i)},t.prototype.getVariable=function(t){return this._file.getVariable(this._nodeList[t])},t.prototype.getAnimation=function(t){return this._file.getAnimation(this._nodeList[t])},t.prototype.getMainline=function(t){return this._file.getBaseline(this._nodeList[t])},t.prototype.getMainlineKey=function(t){return this._file.getMainlineKey(this._nodeList[t])},t.prototype.getRef=function(t){return this._file.getRef(this._nodeList[t])},t.prototype.getTimeline=function(t){return this._file.getTimeline(this._nodeList[t])},t.prototype.getSoundline=function(t){return this._file.getBaseline(this._nodeList[t])},t.prototype.getEventline=function(t){return this._file.getBaseline(this._nodeList[t])},t.prototype.getTagline=function(t){return this._file.getBaseline(this._nodeList[t])},t.prototype.getVarline=function(t){return this._file.getVarline(this._nodeList[t])},t.prototype.getKey=function(t){return this._file.getKey(this._nodeList[t])},t.prototype.getTagKey=function(t){return this._file.getTagKey(this._nodeList[t])},t.prototype.getVariableKey=function(t,e){return this._file.getVariableKey(this._nodeList[t],e)},t.prototype.getTimelineKey=function(t,e){return this._file.getTimelineKey(this._nodeList[t],t,e)},t.prototype.getTagChanges=function(t){for(var e=0,i=0;i<this.length();i++){var n=this._file.getTagChange(this._nodeList[i]);e|=1<<n}return e},t}();t.NodeListBin=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t,e){this._file=t,this._nodeList=e,Array.isArray(e)||(e.length=1)}return t.prototype.length=function(){return this._nodeList.length},t.prototype.processed=function(){this._file.processed()},t.prototype.getNode=function(t){return Array.isArray(this._nodeList)?this._nodeList[t]:this._nodeList},t.prototype.getChildNodes=function(t,e){return this._file.getNodesForElement(this.getNode(t),e)},t.prototype.getFolder=function(t){return this._file.getFolder(this.getNode(t))},t.prototype.getFile=function(t){return this._file.getFile(this.getNode(t))},t.prototype.getTag=function(t){return this._file.getTag(this.getNode(t));
},t.prototype.getEntity=function(t){return this._file.getEntity(this.getNode(t))},t.prototype.getObjectInfo=function(t){return this._file.getObjectInfo(this.getNode(t),t)},t.prototype.getCharMap=function(t){return this._file.getCharMap(this.getNode(t))},t.prototype.getCharMapEntry=function(t,e,i){this._file.getCharMapEntry(this.getNode(t),e,i)},t.prototype.getVariable=function(t){return this._file.getVariable(this.getNode(t))},t.prototype.getAnimation=function(t){return this._file.getAnimation(this.getNode(t))},t.prototype.getMainline=function(t){return this._file.getBaseline(this.getNode(t))},t.prototype.getMainlineKey=function(t){return this._file.getMainlineKey(this.getNode(t))},t.prototype.getRef=function(t){return this._file.getRef(this.getNode(t))},t.prototype.getTimeline=function(t){return this._file.getTimeline(this.getNode(t))},t.prototype.getSoundline=function(t){return this._file.getBaseline(this.getNode(t))},t.prototype.getEventline=function(t){return this._file.getBaseline(this.getNode(t))},t.prototype.getTagline=function(t){return this._file.getBaseline(this.getNode(t))},t.prototype.getVarline=function(t){return this._file.getVarline(this.getNode(t))},t.prototype.getKey=function(t){return this._file.getKey(this.getNode(t))},t.prototype.getTagKey=function(t){return this._file.getTagKey(this.getNode(t))},t.prototype.getVariableKey=function(t,e){return this._file.getVariableKey(this.getNode(t),e)},t.prototype.getTimelineKey=function(t,e){return this._file.getTimelineKey(this.getNode(t),t,e)},t.prototype.getTagChanges=function(t){for(var e=0,i=0;i<this.length();i++){var n=this._file.getTagChange(this.getNode(i));e|=1<<n}return e},t}();t.NodeListJSON=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t,e){this._file=t,this._nodeList=e}return t.prototype.length=function(){return this._nodeList.length},t.prototype.processed=function(){this._file.processed()},t.prototype.getChildNodes=function(t,e){return this._file.getNodesForElement(this._nodeList.item(t),e)},t.prototype.getFolder=function(t){return this._file.getFolder(this._nodeList.item(t))},t.prototype.getFile=function(t){return this._file.getFile(this._nodeList.item(t))},t.prototype.getTag=function(t){return this._file.getTag(this._nodeList.item(t))},t.prototype.getEntity=function(t){return this._file.getEntity(this._nodeList.item(t))},t.prototype.getObjectInfo=function(t){return this._file.getObjectInfo(this._nodeList.item(t),t)},t.prototype.getCharMap=function(t){return this._file.getCharMap(this._nodeList.item(t))},t.prototype.getCharMapEntry=function(t,e,i){this._file.getCharMapEntry(this._nodeList.item(t),e,i)},t.prototype.getVariable=function(t){return this._file.getVariable(this._nodeList.item(t))},t.prototype.getAnimation=function(t){return this._file.getAnimation(this._nodeList.item(t))},t.prototype.getMainline=function(t){return this._file.getBaseline(this._nodeList.item(t))},t.prototype.getMainlineKey=function(t){return this._file.getMainlineKey(this._nodeList.item(t))},t.prototype.getRef=function(t){return this._file.getRef(this._nodeList.item(t))},t.prototype.getTimeline=function(t){return this._file.getTimeline(this._nodeList.item(t))},t.prototype.getSoundline=function(t){return this._file.getBaseline(this._nodeList.item(t))},t.prototype.getEventline=function(t){return this._file.getBaseline(this._nodeList.item(t))},t.prototype.getTagline=function(t){return this._file.getBaseline(this._nodeList.item(t))},t.prototype.getVarline=function(t){return this._file.getVarline(this._nodeList.item(t))},t.prototype.getKey=function(t){return this._file.getKey(this._nodeList.item(t))},t.prototype.getTagKey=function(t){return this._file.getTagKey(this._nodeList.item(t))},t.prototype.getVariableKey=function(t,e){return this._file.getVariableKey(this._nodeList.item(t),e)},t.prototype.getTimelineKey=function(t,e){return this._file.getTimelineKey(this._nodeList.item(t),t,e)},t.prototype.getTagChanges=function(t){for(var e=0,i=0;i<this.length();i++){var n=this._file.getTagChange(this._nodeList.item(i));e|=1<<n}return e},t}();t.NodeListXml=e}(Spriter||(Spriter={}));var Spriter;!function(t){!function(t){t[t.XML=0]="XML",t[t.JSON=1]="JSON",t[t.BIN=2]="BIN"}(t.eFileType||(t.eFileType={}));t.eFileType;!function(t){t[t.ORIGINAL=0]="ORIGINAL",t[t.NAME_ONLY=1]="NAME_ONLY",t[t.NAME_AND_EXTENSION=2]="NAME_AND_EXTENSION",t[t.FULL_PATH_NO_EXTENSION=3]="FULL_PATH_NO_EXTENSION"}(t.eImageNameType||(t.eImageNameType={}));var e=t.eImageNameType,i=function(){function t(t){var i="undefined"!=typeof t&&null!==t;this._imageNameType=i&&"undefined"!=typeof t.imageNameType?t.imageNameType:e.NAME_ONLY,this._minDefs=i&&"undefined"!=typeof t.minDefs?t.minDefs:null}return t.prototype.processed=function(){this.popMinDefsStack()},t.prototype.setMinimized=function(t){this._minimized=t,t&&(this._minDefsStack=[],null===this._minDefs)},t.prototype.getFileName=function(t){var i;switch(this._imageNameType){case e.NAME_ONLY:i=t.split("\\").pop().split("/").pop().split(".")[0];break;case e.NAME_AND_EXTENSION:i=t.split("\\").pop().split("/").pop();break;case e.FULL_PATH_NO_EXTENSION:i=t.split(".")[0];break;case e.ORIGINAL:i=t}return i},t.prototype.translateElementName=function(t){if(this._minimized){if(this._minDefs.name!==t)return t;null!==this._minDefs.minName&&(t=this._minDefs.minName)}return t},t.prototype.translateChildElementName=function(t){if(this._minimized&&null!==this._minDefs){var e=this._minDefs.childElements;null!==e&&(t=null===e[t]?t:e[t].minName)}return t},t.prototype.translateAttributeName=function(t){if(this._minimized&&null!==this._minDefs){var e=this._minDefs.attributes;null!==e&&(t=null===e[t]?t:e[t])}return t},t.prototype.setMinDefsToElementName=function(t){if(this._minimized){this._minDefsStack.push(this._minDefs);var e=this._minDefs.childElements[t];this._minDefs=e}},t.prototype.popMinDefsStack=function(){this._minimized&&(this._minDefs=this._minDefsStack.pop())},t}();t.SpriterFile=i}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(t){e.call(this,null),this._elements={spriter_data:1,folder:2,file:3,entity:4,obj_info:5,frames:6,i:7,animation:8,mainline:9,key:10,bone_ref:11,object_ref:12,timeline:13,bone:14,object:15},this._smallOffset=!1,this._bin=new DataView(t),this._smallOffset=1===this._bin.getUint8(0)}return __extends(i,e),i.prototype.getType=function(){return t.eFileType.BIN},i.prototype.readUint8=function(){return this._bin.getUint8(this._tmpPosition++)},i.prototype.readInt8=function(){return this._bin.getInt8(this._tmpPosition++)},i.prototype.readUint16=function(){var t=this._bin.getUint16(this._tmpPosition,!0);return this._tmpPosition+=2,t},i.prototype.readInt16=function(){var t=this._bin.getInt16(this._tmpPosition,!0);return this._tmpPosition+=2,t},i.prototype.readUint32=function(){var t=this._bin.getUint32(this._tmpPosition,!0);return this._tmpPosition+=4,t},i.prototype.readInt32=function(){var t=this._bin.getInt32(this._tmpPosition,!0);return this._tmpPosition+=4,t},i.prototype.readFixed16_16=function(){var t=this._bin.getInt32(this._tmpPosition,!0);return this._tmpPosition+=4,t/65536},i.prototype.readFixed1_7=function(){var t=255&this._bin.getInt8(this._tmpPosition++);return t/128},i.prototype.readString=function(){for(var t=[],e=this._bin.getUint8(this._tmpPosition++)-1;e>=0;e--)t.push(this._bin.getUint8(this._tmpPosition++));return String.fromCharCode.apply(null,t)},i.prototype.getNodes=function(e){return new t.NodeListBin(this,this.getSubNodesOfElementType(1,this._elements[e]))},i.prototype.getNodesForElement=function(e,i){return new t.NodeListBin(this,this.getSubNodesOfElementType(e,this._elements[i]))},i.prototype.getSubNodesOfElementType=function(t,e){var i=[],n=this._bin.getUint8(t+1);t+=2;for(var r=0;n>r;r++){var s=this._smallOffset?this._bin.getUint16(t+2*r,!0):this._bin.getUint32(t+4*r,!0),a=this._bin.getUint8(t+s);a===e&&i.push(t+s)}return i},i.prototype.getAttribsPosition=function(t){var e=this._bin.getUint8(t+1);return t+2+e*(this._smallOffset?2:4)},i.prototype.getFolder=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r="",s=this._bin.getUint8(this._tmpPosition++)-1;s>=0;s--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_FOLDER_ID:n=this.readUint8();break;case i.ATTR_FOLDER_NAME:r=this.readString()}return new t.Folder(n,r)},i.prototype.getFile=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r="",s=0,a=0,o=this._bin.getUint8(this._tmpPosition++)-1;o>=0;o--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_FILE_ID:n=this.readUint8();break;case i.ATTR_FILE_NAME:r=this.readString();break;case i.ATTR_FILE_PIVOT_X:s=this.readFixed16_16();break;case i.ATTR_FILE_PIVOT_Y:a=this.readFixed16_16();break;case i.ATTR_FILE_WIDTH:case i.ATTR_FILE_HEIGHT:this._tmpPosition+=2}return new t.File(n,this.getFileName(r),s,1-a)},i.prototype.getTag=function(t){return null},i.prototype.getEntity=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r="",s=this._bin.getUint8(this._tmpPosition++)-1;s>=0;s--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_ENTITY_ID:n=this.readUint8();break;case i.ATTR_ENTITY_NAME:r=this.readString()}return new t.Entity(n,r)},i.prototype.getObjectInfo=function(e,n){this._tmpPosition=this.getAttribsPosition(e);for(var r="",s=0,a=0,o=0,h=this._bin.getUint8(this._tmpPosition++)-1;h>=0;h--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_OBJ_INFO_NAME:r=this.readString();break;case i.ATTR_OBJ_INFO_TYPE:1===this.readUint8()&&(s=1);break;case i.ATTR_OBJ_INFO_WIDTH:a=this.readFixed16_16();break;case i.ATTR_OBJ_INFO_HEIGHT:o=this.readFixed16_16()}return new t.ObjectInfo(n,r,s,a,o,0,0)},i.prototype.getCharMap=function(t){return null},i.prototype.getCharMapEntry=function(t,e,i){return null},i.prototype.getVariable=function(t){return null},i.prototype.getAnimation=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r="",s=0,a=t.eAnimationLooping.LOOPING,o=this._bin.getUint8(this._tmpPosition++)-1;o>=0;o--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_ANIMATION_ID:n=this.readUint8();break;case i.ATTR_ANIMATION_NAME:r=this.readString();break;case i.ATTR_ANIMATION_LENGTH:s=this.readUint32();break;case i.ATTR_ANIMATION_INTERVAL:this._tmpPosition+=2;break;case i.ATTR_ANIMATION_LOOPING:a=1===this.readUint8()?t.eAnimationLooping.LOOPING:t.eAnimationLooping.NO_LOOPING}return new t.Animation(n,r,s,a)},i.prototype.getMainlineKey=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r=0,s=this._bin.getUint8(this._tmpPosition++)-1;s>=0;s--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_MAINLINE_KEY_ID:n=this.readUint8();break;case i.ATTR_MAINLINE_KEY_TIME:r=this.readUint32()}return new t.KeyMainline(n,r)},i.prototype.getRef=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r=-1,s=0,a=0,o=0,h=this._bin.getUint8(this._tmpPosition++)-1;h>=0;h--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_BONE_REF_ID:case i.ATTR_OBJ_REF_ID:n=this.readUint8();break;case i.ATTR_BONE_REF_PARENT:case i.ATTR_OBJ_REF_PARENT:r=this.readUint8();break;case i.ATTR_BONE_REF_TIMELINE:case i.ATTR_OBJ_REF_TIMELINE:s=this.readUint8();break;case i.ATTR_BONE_REF_KEY:case i.ATTR_OBJ_REF_KEY:a=this.readUint8();break;case i.ATTR_OBJ_REF_Z:o=this.readUint8();break;case i.ATTR_OBJ_REF_NAME:this.readString();break;case i.ATTR_OBJ_REF_FOLDER:case i.ATTR_OBJ_REF_FILE:++this._tmpPosition;break;case i.ATTR_OBJ_REF_ABS_X:case i.ATTR_OBJ_REF_ABS_Y:case i.ATTR_OBJ_REF_ABS_PIVOT_X:case i.ATTR_OBJ_REF_ABS_PIVOT_Y:case i.ATTR_OBJ_REF_ABS_SCALE_X:case i.ATTR_OBJ_REF_ABS_SCALE_Y:case i.ATTR_OBJ_REF_ANGLE:this._tmpPosition+=4;break;case i.ATTR_OBJ_REF_ALPHA:++this._tmpPosition}return new t.Ref(n,r,s,a,o)},i.prototype.getTimeline=function(e){this._tmpPosition=this.getAttribsPosition(e);for(var n=0,r="",s=0,a=0,o=this._bin.getUint8(this._tmpPosition++)-1;o>=0;o--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_TIMELINE_ID:n=this.readUint8();break;case i.ATTR_TIMELINE_NAME:r=this.readString();break;case i.ATTR_TIMELINE_OBJ:s=this.readUint8();break;case i.ATTR_TIMELINE_OBJ_TYPE:1===this.readUint8()&&(a=1)}return new t.Timeline(n,r,a,s)},i.prototype.getBaseline=function(t){return null},i.prototype.getVarline=function(t){return null},i.prototype.getKey=function(t){return null},i.prototype.getTagKey=function(t){return null},i.prototype.getVariableKey=function(t,e){return null},i.prototype.getTimelineKey=function(e,n,r){this._tmpPosition=this.getAttribsPosition(e);for(var s=0,a=1,o=0,h=0,p=0,l=0,c=0,u=this._bin.getUint8(this._tmpPosition++)-1;u>=0;u--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_TIMELINE_KEY_ID:++this._tmpPosition;break;case i.ATTR_TIMELINE_KEY_TIME:s=this.readUint32();break;case i.ATTR_TIMELINE_KEY_SPIN:a=this.readInt8();break;case i.ATTR_TIMELINE_KEY_CURVE:o=this.readUint8();break;case i.ATTR_TIMELINE_KEY_C1:h=this.readFixed1_7();break;case i.ATTR_TIMELINE_KEY_C2:p=this.readFixed1_7()}e+=2;var _=e+(this._smallOffset?this._bin.getUint16(e,!0):this._bin.getUint32(e,!0)),d=this._bin.getUint8(_),f=null,m=!1;14===d?f=new t.KeyBone(n,s,a):15===d&&(f=new t.KeyObject(n,s,a),m=!0),0!==o&&f.setCurve(o,h,p,l,c),this._tmpPosition=this.getAttribsPosition(_);var g=f.info;g.x=0,g.y=0,g.scaleX=1,g.scaleY=1,g.angle=0,g.alpha=1;for(var y=0,v=!1,T=0,b=!1,I=0,A=0,u=this._bin.getUint8(this._tmpPosition++)-1;u>=0;u--)switch(this._bin.getUint8(this._tmpPosition++)){case i.ATTR_BONE_X:case i.ATTR_OBJ_X:g.x=this.readFixed16_16();break;case i.ATTR_BONE_Y:case i.ATTR_OBJ_Y:g.y=-this.readFixed16_16();break;case i.ATTR_BONE_ANGLE:case i.ATTR_OBJ_ANGLE:g.angle=360-this.readFixed16_16();break;case i.ATTR_BONE_SCALE_X:case i.ATTR_OBJ_SCALE_X:g.scaleX=this.readFixed16_16();break;case i.ATTR_BONE_SCALE_Y:case i.ATTR_OBJ_SCALE_Y:g.scaleY=this.readFixed16_16();break;case i.ATTR_OBJ_FOLDER:I=this.readUint8();break;case i.ATTR_OBJ_FILE:A=this.readUint8();break;case i.ATTR_OBJ_PIVOT_X:y=this.readFixed16_16(),v=!0;break;case i.ATTR_OBJ_PIVOT_Y:T=this.readFixed16_16(),b=!0;break;case i.ATTR_OBJ_ALPHA:g.alpha=this.readFixed1_7()}if(m){f.setFolderAndFile(I,A);var E=r.getFolderById(I).getFileById(A);g.pivotX=v?y:E.pivotX,g.pivotY=1-(b?T:1-E.pivotY)}return f},i.prototype.getTagChange=function(t){return null},i.ATTR_VERSION=0,i.ATTR_GENERATOR=1,i.ATTR_GENERATOR_VERSION=2,i.ATTR_FOLDER_ID=0,i.ATTR_FOLDER_NAME=1,i.ATTR_FILE_ID=0,i.ATTR_FILE_NAME=1,i.ATTR_FILE_WIDTH=2,i.ATTR_FILE_HEIGHT=3,i.ATTR_FILE_PIVOT_X=4,i.ATTR_FILE_PIVOT_Y=5,i.ATTR_ENTITY_ID=0,i.ATTR_ENTITY_NAME=1,i.ATTR_OBJ_INFO_NAME=0,i.ATTR_OBJ_INFO_TYPE=1,i.ATTR_OBJ_INFO_WIDTH=2,i.ATTR_OBJ_INFO_HEIGHT=3,i.ATTR_FRAMES_I_FOLDER=0,i.ATTR_FRAMES_I_FILE=1,i.ATTR_ANIMATION_ID=0,i.ATTR_ANIMATION_NAME=1,i.ATTR_ANIMATION_LENGTH=2,i.ATTR_ANIMATION_INTERVAL=3,i.ATTR_ANIMATION_LOOPING=4,i.ATTR_MAINLINE_KEY_ID=0,i.ATTR_MAINLINE_KEY_TIME=1,i.ATTR_BONE_REF_ID=0,i.ATTR_BONE_REF_PARENT=1,i.ATTR_BONE_REF_TIMELINE=2,i.ATTR_BONE_REF_KEY=3,i.ATTR_OBJ_REF_ID=4,i.ATTR_OBJ_REF_PARENT=5,i.ATTR_OBJ_REF_TIMELINE=6,i.ATTR_OBJ_REF_KEY=7,i.ATTR_OBJ_REF_NAME=8,i.ATTR_OBJ_REF_Z=9,i.ATTR_OBJ_REF_FOLDER=10,i.ATTR_OBJ_REF_FILE=11,i.ATTR_OBJ_REF_ABS_X=12,i.ATTR_OBJ_REF_ABS_Y=13,i.ATTR_OBJ_REF_ABS_PIVOT_X=14,i.ATTR_OBJ_REF_ABS_PIVOT_Y=15,i.ATTR_OBJ_REF_ABS_SCALE_X=16,i.ATTR_OBJ_REF_ABS_SCALE_Y=17,i.ATTR_OBJ_REF_ANGLE=18,i.ATTR_OBJ_REF_ALPHA=19,i.ATTR_TIMELINE_ID=0,i.ATTR_TIMELINE_NAME=1,i.ATTR_TIMELINE_OBJ=2,i.ATTR_TIMELINE_OBJ_TYPE=3,i.ATTR_TIMELINE_KEY_ID=0,i.ATTR_TIMELINE_KEY_TIME=1,i.ATTR_TIMELINE_KEY_SPIN=2,i.ATTR_TIMELINE_KEY_CURVE=3,i.ATTR_TIMELINE_KEY_C1=4,i.ATTR_TIMELINE_KEY_C2=5,i.ATTR_BONE_X=0,i.ATTR_BONE_Y=1,i.ATTR_BONE_ANGLE=2,i.ATTR_BONE_SCALE_X=3,i.ATTR_BONE_SCALE_Y=4,i.ATTR_OBJ_FOLDER=5,i.ATTR_OBJ_FILE=6,i.ATTR_OBJ_X=7,i.ATTR_OBJ_Y=8,i.ATTR_OBJ_SCALE_X=9,i.ATTR_OBJ_SCALE_Y=10,i.ATTR_OBJ_PIVOT_X=11,i.ATTR_OBJ_PIVOT_Y=12,i.ATTR_OBJ_ANGLE=13,i.ATTR_OBJ_ALPHA=14,i}(t.SpriterFile);t.SpriterBin=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(t,i){e.call(this,i),this._json=t;var n=void 0!==t.min;this.setMinimized(n)}return __extends(i,e),i.prototype.getType=function(){return t.eFileType.JSON},i.prototype.parseInt=function(t,e,i){void 0===i&&(i=0);var n=t[this.translateAttributeName(e)];return void 0===n?i:"number"==typeof n?n:parseInt(n)},i.prototype.parseFloat=function(t,e,i){void 0===i&&(i=0);var n=t[this.translateAttributeName(e)];return void 0===n?i:"number"==typeof n?n:parseFloat(n)},i.prototype.parseBoolean=function(t,e,i){void 0===i&&(i=!1);var n=t[this.translateAttributeName(e)];return void 0===n?i:"boolean"==typeof n?n:"true"===n},i.prototype.parseString=function(t,e,i){void 0===i&&(i="");var n=t[this.translateAttributeName(e)];return void 0===n?i:n},i.prototype.getNodes=function(e){this.setMinDefsToElementName(e);var i=this.translateElementName(e);return new t.NodeListJSON(this,void 0!==this._json[i]?this._json[i]:[])},i.prototype.getNodesForElement=function(e,i){this.setMinDefsToElementName(i);var n=this.translateElementName(i);return new t.NodeListJSON(this,void 0!==e[n]?e[n]:[])},i.prototype.getFolder=function(e){return new t.Folder(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getFile=function(e){return void 0!==e.type&&"sound"===e.type?null:new t.File(this.parseInt(e,"id"),this.getFileName(this.parseString(e,"name")),this.parseFloat(e,"pivot_x"),1-this.parseFloat(e,"pivot_y"))},i.prototype.getTag=function(e){return new t.Item(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getEntity=function(e){return new t.Entity(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getObjectInfo=function(e,i){return new t.ObjectInfo(i,this.parseString(e,"name"),t.Types.getObjectTypeForName(this.parseString(e,"type")),this.parseFloat(e,"w"),this.parseFloat(e,"h"),this.parseFloat(e,"pivot_x"),this.parseFloat(e,"pivot_y"))},i.prototype.getCharMap=function(e){return new t.CharMap(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getCharMapEntry=function(t,e,i){var n=i.getFolderById(this.parseInt(t,"folder")).getFileById(this.parseInt(t,"file")).name,r=null;void 0!==t.target_folder&&void 0!==t.target_file&&(r=i.getFolderById(this.parseInt(t,"target_folder")).getFileById(this.parseInt(t,"target_file"))),e.put(n,r)},i.prototype.getVariable=function(e){var i=t.Types.getVariableTypeForName(this.parseString(e,"type"));return new t.Variable(this.parseInt(e,"id"),this.parseString(e,"name"),i,2===i?this.parseString(e,"default"):this.parseFloat(e,"default",0))},i.prototype.getAnimation=function(e){return new t.Animation(this.parseInt(e,"id"),this.parseString(e,"name"),this.parseFloat(e,"length"),this.parseBoolean(e,"looping",!0)===!0?t.eAnimationLooping.LOOPING:t.eAnimationLooping.NO_LOOPING)},i.prototype.getMainlineKey=function(e){return new t.KeyMainline(this.parseInt(e,"id"),this.parseFloat(e,"time"))},i.prototype.getRef=function(e){return new t.Ref(this.parseInt(e,"id"),this.parseInt(e,"parent",-1),this.parseInt(e,"timeline"),this.parseInt(e,"key"),this.parseInt(e,"z_index"))},i.prototype.getTimeline=function(e){return new t.Timeline(this.parseInt(e,"id"),this.parseString(e,"name"),t.Types.getObjectTypeForName(this.parseString(e,"object_type","sprite")),this.parseInt(e,"obj",-1))},i.prototype.getBaseline=function(e){return new t.Baseline(this.parseInt(e,"id"),this.parseString(e,"name",null))},i.prototype.getVarline=function(e){return new t.Varline(this.parseInt(e,"id"),this.parseInt(e,"def"))},i.prototype.getKey=function(e){return new t.Key(this.parseInt(e,"id"),this.parseInt(e,"time"))},i.prototype.getTagKey=function(e){return new t.KeyTag(this.parseInt(e,"id"),this.parseInt(e,"time"))},i.prototype.getVariableKey=function(e,i){return new t.KeyVariable(this.parseInt(e,"id"),this.parseInt(e,"time"),2===i?this.parseString(e,"val"):this.parseFloat(e,"val"))},i.prototype.getTimelineKey=function(e,i,n){var r=this.parseInt(e,"time"),s=this.parseInt(e,"spin",1),a=this.parseString(e,"curve_type","linear"),o=this.parseFloat(e,"c1",0),h=this.parseFloat(e,"c2",0),p=this.parseFloat(e,"c3",0),l=this.parseFloat(e,"c4",0),c=this.translateChildElementName("bone"),u=this.translateChildElementName("object"),_=null,d=null,f=!1;void 0!==e[c]?(d=e[c],_=new t.KeyBone(i,r,s),this.setMinDefsToElementName("bone")):void 0!==e[u]&&(d=e[u],_=new t.KeyObject(i,r,s),this.setMinDefsToElementName("object"),f=!0),"linear"!==a&&_.setCurve(t.Types.getCurveTypeForName(a),o,h,p,l);var m=_.info;if(m.x=this.parseFloat(d,"x"),m.y=-this.parseFloat(d,"y"),m.scaleX=this.parseFloat(d,"scale_x",1),m.scaleY=this.parseFloat(d,"scale_y",1),m.angle=360-this.parseFloat(d,"angle"),m.alpha=this.parseFloat(d,"a",1),f){var g=this.parseInt(d,"folder"),y=this.parseInt(d,"file");_.setFolderAndFile(g,y);var v=n.getFolderById(g).getFileById(y);m.pivotX=this.parseFloat(d,"pivot_x",v.pivotX),m.pivotY=1-this.parseFloat(d,"pivot_y",1-v.pivotY)}return this.popMinDefsStack(),_},i.prototype.getTagChange=function(t){return this.parseInt(t,"t")},i}(t.SpriterFile);t.SpriterJSON=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(t,i){e.call(this,i),this._xml=t;var n=t.documentElement.hasAttribute("min");this.setMinimized(n)}return __extends(i,e),i.prototype.getType=function(){return t.eFileType.XML},i.prototype.parseInt=function(t,e,i){void 0===i&&(i=0);var n=t.getAttribute(this.translateAttributeName(e));return null!==n?parseInt(n):i},i.prototype.parseFloat=function(t,e,i){void 0===i&&(i=0);var n=t.getAttribute(this.translateAttributeName(e));return null!==n?parseFloat(n):i},i.prototype.parseString=function(t,e,i){void 0===i&&(i="");var n=t.getAttribute(this.translateAttributeName(e));return null!==n?n:i},i.prototype.getNodes=function(e){this.setMinDefsToElementName(e);var i=this.translateElementName(e);return new t.NodeListXml(this,this._xml.documentElement.getElementsByTagName(i))},i.prototype.getNodesForElement=function(e,i){this.setMinDefsToElementName(i);var n=this.translateElementName(i);return new t.NodeListXml(this,e.getElementsByTagName(n))},i.prototype.getFolder=function(e){return new t.Folder(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getFile=function(e){return e.hasAttribute("type")&&"sound"===e.getAttribute("type")?null:new t.File(this.parseInt(e,"id"),this.getFileName(this.parseString(e,"name")),this.parseFloat(e,"pivot_x"),1-this.parseFloat(e,"pivot_y"))},i.prototype.getTag=function(e){return new t.Item(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getEntity=function(e){return new t.Entity(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getObjectInfo=function(e,i){return new t.ObjectInfo(i,this.parseString(e,"name"),t.Types.getObjectTypeForName(this.parseString(e,"type")),this.parseFloat(e,"w"),this.parseFloat(e,"h"),this.parseFloat(e,"pivot_x"),this.parseFloat(e,"pivot_y"))},i.prototype.getCharMap=function(e){return new t.CharMap(this.parseInt(e,"id"),this.parseString(e,"name"))},i.prototype.getCharMapEntry=function(t,e,i){var n=i.getFolderById(this.parseInt(t,"folder")).getFileById(this.parseInt(t,"file")).name,r=null;t.hasAttribute("target_folder")&&t.hasAttribute("target_file")&&(r=i.getFolderById(this.parseInt(t,"target_folder")).getFileById(this.parseInt(t,"target_file"))),e.put(n,r)},i.prototype.getVariable=function(e){var i=t.Types.getVariableTypeForName(this.parseString(e,"type"));return new t.Variable(this.parseInt(e,"id"),this.parseString(e,"name"),i,2===i?this.parseString(e,"default"):this.parseFloat(e,"default",0))},i.prototype.getAnimation=function(e){return new t.Animation(this.parseInt(e,"id"),this.parseString(e,"name"),this.parseFloat(e,"length"),"true"===this.parseString(e,"looping","true")?t.eAnimationLooping.LOOPING:t.eAnimationLooping.NO_LOOPING)},i.prototype.getMainlineKey=function(e){return new t.KeyMainline(this.parseInt(e,"id"),this.parseFloat(e,"time"))},i.prototype.getRef=function(e){return new t.Ref(this.parseInt(e,"id"),this.parseInt(e,"parent",-1),this.parseInt(e,"timeline"),this.parseInt(e,"key"),this.parseInt(e,"z_index"))},i.prototype.getTimeline=function(e){return new t.Timeline(this.parseInt(e,"id"),this.parseString(e,"name"),t.Types.getObjectTypeForName(this.parseString(e,"object_type","sprite")),this.parseInt(e,"obj",-1))},i.prototype.getBaseline=function(e){return new t.Baseline(this.parseInt(e,"id"),this.parseString(e,"name",null))},i.prototype.getVarline=function(e){return new t.Varline(this.parseInt(e,"id"),this.parseInt(e,"def"))},i.prototype.getKey=function(e){return new t.Key(this.parseInt(e,"id"),this.parseInt(e,"time"))},i.prototype.getTagKey=function(e){return new t.KeyTag(this.parseInt(e,"id"),this.parseInt(e,"time"))},i.prototype.getVariableKey=function(e,i){return new t.KeyVariable(this.parseInt(e,"id"),this.parseInt(e,"time"),2===i?this.parseString(e,"val"):this.parseFloat(e,"val"))},i.prototype.getTimelineKey=function(e,i,n){var r=this.parseInt(e,"time"),s=this.parseInt(e,"spin",1),a=this.parseString(e,"curve_type","linear"),o=this.parseFloat(e,"c1",0),h=this.parseFloat(e,"c2",0),p=this.parseFloat(e,"c3",0),l=this.parseFloat(e,"c4",0),c=this.translateChildElementName("bone"),u=this.translateChildElementName("object"),_=null,d=e.firstElementChild,f=!1;d.tagName===c?(_=new t.KeyBone(i,r,s),this.setMinDefsToElementName("bone")):d.tagName===u&&(this.setMinDefsToElementName("object"),_=new t.KeyObject(i,r,s),f=!0),"linear"!==a&&_.setCurve(t.Types.getCurveTypeForName(a),o,h,p,l);var m=_.info;if(m.x=this.parseFloat(d,"x"),m.y=-this.parseFloat(d,"y"),m.scaleX=this.parseFloat(d,"scale_x",1),m.scaleY=this.parseFloat(d,"scale_y",1),m.angle=360-this.parseFloat(d,"angle"),m.alpha=this.parseFloat(d,"a",1),f){var g=this.parseInt(d,"folder"),y=this.parseInt(d,"file");_.setFolderAndFile(g,y);var v=n.getFolderById(g).getFileById(y);m.pivotX=this.parseFloat(d,"pivot_x",v.pivotX),m.pivotY=1-this.parseFloat(d,"pivot_y",1-v.pivotY)}return this.popMinDefsStack(),_},i.prototype.getTagChange=function(t){return this.parseInt(t,"t")},i}(t.SpriterFile);t.SpriterXml=e}(Spriter||(Spriter={}));var Spriter;!function(t){function e(t,e,i){return(e-t)*i+t}function i(t,i,n,r){return e(e(t,i,r),e(i,n,r),r)}function n(t,n,r,s,a){return e(i(t,n,r,a),i(n,r,s,a),a)}function r(t,i,r,s,a,o){return e(n(t,i,r,s,o),n(i,r,s,a,o),o)}function s(t,i,n,s,a,o,h){return e(r(t,i,n,s,a,h),r(i,n,s,a,o,h),h)}function a(t,e,i){var n=1,r=1-i,s=i*i,a=r*r,o=s*i;return 0+3*a*i*t+3*r*s*e+o*n}function o(t,e,i,n,r){for(var s=.001,o=10,h=0,p=1,l=(p+h)/2,c=a(t,i,l),u=0;Math.abs(r-c)>s&&o>u;)r>c?h=l:p=l,l=(p+h)/2,c=a(t,i,l),++u;return a(e,n,l)}function h(t,e,i,n){return 0===i?t:(i>0?e>t&&(e-=360):t>e&&(e+=360),this.linear(t,e,n))}t.linear=e,t.quadratic=i,t.cubic=n,t.quartic=r,t.quintic=s,t.bezier=o,t.angleLinear=h}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function e(){this._folders=new t.IdNameMap,this._tags=new t.IdNameMap,this._entities=new t.IdNameMap}return e.prototype.addFolder=function(t){this._folders.add(t,t.id,t.name)},e.prototype.getFolderById=function(t){return this._folders.getById(t)},e.prototype.getFolderByName=function(t){return this._folders.getByName(t)},e.prototype.addEntity=function(t){this._entities.add(t,t.id,t.name)},e.prototype.getEntityById=function(t){return this._entities.getById(t)},e.prototype.getEntityByName=function(t){return this._entities.getByName(t)},e.prototype.addTag=function(t){this._tags.add(t,t.id,t.name)},e.prototype.getTagById=function(t){return this._tags.getById(t)},e.prototype.getTagByName=function(t){return this._tags.getByName(t)},Object.defineProperty(e.prototype,"tagsLength",{get:function(){return this._tags.length},enumerable:!0,configurable:!0}),e}();t.Spriter=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function e(){this.timeline=-1,this.timelineKey=-1,this.transformed=new t.SpatialInfo}return e.prototype.setOn=function(t){this._on=t},Object.defineProperty(e.prototype,"on",{get:function(){return this._on},enumerable:!0,configurable:!0}),e.prototype.setKey=function(i,n,r,s){this.timeline=r,this.timelineKey=s;var a=n.getTimelineById(r);this.name=a.name,this.objectInfo=-1===a.objectRef?null:i.getObjectInfoById(a.objectRef);var o=a.at(s),h=a.at(s+1,n.loopType!==t.eAnimationLooping.NO_LOOPING);this.key=o,this.timeFrom=o.time,this.timeTo=h.time,this.timeTo<this.timeFrom&&(this.timeTo=n.length),this.from=o.info,this.to=h.info,this.updateMask=0,Math.abs(this.from.x-this.to.x)>.001&&(this.updateMask+=e.UPDATE_X),Math.abs(this.from.y-this.to.y)>.001&&(this.updateMask+=e.UPDATE_Y),Math.abs(this.from.scaleX-this.to.scaleX)>.001&&(this.updateMask+=e.UPDATE_SCALE_X),Math.abs(this.from.scaleY-this.to.scaleY)>.001&&(this.updateMask+=e.UPDATE_SCALE_Y),Math.abs(this.from.pivotX-this.to.pivotX)>.001&&(this.updateMask+=e.UPDATE_PIVOT_X),Math.abs(this.from.pivotY-this.to.pivotY)>.001&&(this.updateMask+=e.UPDATE_PIVOT_Y),Math.abs(this.from.alpha-this.to.alpha)>.001&&(this.updateMask+=e.UPDATE_ALPHA),Math.abs(this.from.angle-this.to.angle)>.001&&(this.updateMask+=e.UPDATE_ANGLE),this.transformed.x=this.from.x,this.transformed.y=this.from.y,this.transformed.scaleX=this.from.scaleX,this.transformed.scaleY=this.from.scaleY,this.transformed.pivotX=this.from.pivotX,this.transformed.pivotY=this.from.pivotY,this.transformed.angle=this.from.angle,this.transformed.alpha=this.from.alpha},e.prototype.tween=function(i){var n=this.updateMask>0?this.getTweenTime(i):0;this.transformed.x=(this.updateMask&e.UPDATE_X)>0?t.linear(this.from.x,this.to.x,n):this.from.x,this.transformed.y=(this.updateMask&e.UPDATE_Y)>0?t.linear(this.from.y,this.to.y,n):this.from.y,this.transformed.scaleX=(this.updateMask&e.UPDATE_SCALE_X)>0?t.linear(this.from.scaleX,this.to.scaleX,n):this.from.scaleX,this.transformed.scaleY=(this.updateMask&e.UPDATE_SCALE_Y)>0?t.linear(this.from.scaleY,this.to.scaleY,n):this.from.scaleY,this.transformed.pivotX=(this.updateMask&e.UPDATE_PIVOT_X)>0?t.linear(this.from.pivotX,this.to.pivotX,n):this.from.pivotX,this.transformed.pivotY=(this.updateMask&e.UPDATE_PIVOT_Y)>0?t.linear(this.from.pivotY,this.to.pivotY,n):this.from.pivotY,this.transformed.alpha=(this.updateMask&e.UPDATE_ALPHA)>0?t.linear(this.from.alpha,this.to.alpha,n):this.from.alpha,this.transformed.angle=(this.updateMask&e.UPDATE_ANGLE)>0?t.angleLinear(this.from.angle,this.to.angle,this.key.spin,n):this.from.angle},e.prototype.update=function(t){this.transformed.angle*=Phaser.Math.sign(t.scaleX)*Phaser.Math.sign(t.scaleY),this.transformed.angle+=t.angle,this.transformed.scaleX*=t.scaleX,this.transformed.scaleY*=t.scaleY,this.scalePosition(t.scaleX,t.scaleY),this.rotatePosition(t.angle),this.translatePosition(t.x,t.y),this.transformed.alpha*=t.alpha},e.prototype.scalePosition=function(t,e){this.transformed.x*=t,this.transformed.y*=e},e.prototype.rotatePosition=function(t){var e=this.transformed.x,i=this.transformed.y;if(0!==e||0!==i){var n=t*(Math.PI/180),r=Math.cos(n),s=Math.sin(n);this.transformed.x=e*r-i*s,this.transformed.y=e*s+i*r}},e.prototype.translatePosition=function(t,e){this.transformed.x+=t,this.transformed.y+=e},e.prototype.getTweenTime=function(e){if(1===this.key.curveType)return 0;var i=Phaser.Math.clamp((e-this.timeFrom)/(this.timeTo-this.timeFrom),0,1);switch(this.key.curveType){case 0:return i;case 2:return t.quadratic(0,this.key.c1,1,i);case 3:return t.cubic(0,this.key.c1,this.key.c2,1,i);case 4:return t.quartic(0,this.key.c1,this.key.c2,this.key.c3,1,i);case 5:return t.quintic(0,this.key.c1,this.key.c2,this.key.c3,this.key.c4,1,i);case 6:return t.bezier(this.key.c1,this.key.c2,this.key.c3,this.key.c4,i)}return 0},e.UPDATE_X=1,e.UPDATE_Y=2,e.UPDATE_SCALE_X=4,e.UPDATE_SCALE_Y=8,e.UPDATE_PIVOT_X=16,e.UPDATE_PIVOT_Y=32,e.UPDATE_ANGLE=64,e.UPDATE_ALPHA=128,e}();t.SpriterBone=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(i,n,r,s,a,o){e.call(this,i,null),this.onLoop=new Phaser.Signal,this.onFinish=new Phaser.Signal,this.onSound=new Phaser.Signal,this.onEvent=new Phaser.Signal,
this.onTagChange=new Phaser.Signal,this.onVariableSet=new Phaser.Signal,this.onBoxUpdated=new Phaser.Signal,this.onPointUpdated=new Phaser.Signal,this._mainlineStepper=new t.LineStepper,this._lineSteppers=[],this._lineSteppersCount=0,this._bones=[],this._objects=[],this._tags=0,this._vars=[],this._paused=!1,this._spriter=n,this._entityName=s,this._entity=n.getEntityByName(s),this._textureKey=r,this._root=new t.SpatialInfo;for(var h=0;h<this._entity.variablesLength;h++)this._vars[h]=this._entity.getVariableById(h).clone();this._charMapStack=new t.CharMapStack(this._entity),void 0===o&&(o=100),this.setAnimationSpeedPercent(o),void 0===a||null===a?this.playAnimationById(0):"number"==typeof a?this.playAnimationById(a):this.playAnimationByName(a)}return __extends(i,e),Object.defineProperty(i.prototype,"spriter",{get:function(){return this._spriter},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"charMapStack",{get:function(){return this._charMapStack},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"paused",{get:function(){return this._paused},set:function(t){this.paused=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationsCount",{get:function(){return this._entity.animationsLength},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentAnimationName",{get:function(){return this._animationName},enumerable:!0,configurable:!0}),i.prototype.pushCharMap=function(t){this._charMapStack.push(t),this.resetSprites()},i.prototype.removeCharMap=function(t){this._charMapStack.remove(t),this.resetSprites()},i.prototype.clearCharMaps=function(){this._charMapStack.reset(),this.resetSprites()},i.prototype.resetSprites=function(){for(var t=0;t<this._objects.length;t++)this._objects[t].resetFile()},i.prototype.isTagOn=function(t){return this.isTagOnById(this._spriter.getTagByName(t).id)},i.prototype.isTagOnById=function(t){return(this._tags&1<<t)>0},i.prototype.getVariable=function(t){return this.getVariableById(this._entity.getVariableByName(t).id)},i.prototype.getVariableById=function(t){return this._vars[t]},i.prototype.getObject=function(t){for(var e=0;e<this._objects.length;e++){var i=this._objects[e];if(i.name===t)return i}return null},i.prototype.setAnimationSpeedPercent=function(t){void 0===t&&(t=100),this._animationSpeed=t/100},i.prototype.playAnimationById=function(t){var e=this._entity.getAnimationById(t);void 0!==e&&null!==e&&this.playAnimation(e)},i.prototype.playAnimationByName=function(t){var e=this._entity.getAnimationByName(t);void 0!==e&&null!==e&&this.playAnimation(e)},i.prototype.playAnimation=function(t){this._animationName=t.name,this._animation=t,this._finished=!1,this._mainlineStepper.reset(),this._mainlineStepper.line=this._animation.mainline,this._time=0,this.resetLines(),this._tags=0;for(var e=0;e<this._vars.length;e++)this._vars[e].reset();this.loadKeys(this._animation.mainline.at(0),!0),this.updateCharacter()},i.prototype.resetLines=function(){this._lineSteppersCount=0;for(var e=0;e<this._animation.linesLength;e++){var i=this._animation.getLineById(e);this._lineSteppersCount>=this._lineSteppers.length&&(this._lineSteppers[this._lineSteppersCount]=new t.LineStepper);var n=this._lineSteppers[this._lineSteppersCount++];n.reset(),n.line=i}},i.prototype.setBones=function(e,i){void 0===i&&(i=!1);for(var n=0;n<this._bones.length;n++)void 0!==this._bones[n]&&this._bones[n].setOn(!1);for(var n=0;n<e.length;n++){var r=e[n];if(void 0===this._bones[r.id]){var s=new t.SpriterBone;s.type=1,this._bones[r.id]=s}var a=this._bones[r.id];a.setOn(!0),a.parent=r.parent,(a.timelineKey!==r.key||a.timeline!==r.timeline||i)&&a.setKey(this._entity,this._animation,r.timeline,r.key)}},i.prototype.setObjects=function(e,i){void 0===i&&(i=!1);for(var n=0;n<this._objects.length;n++)void 0!==this._objects[n]&&this._objects[n].setOn(!1);for(var r=!1,n=0;n<e.length;n++){var s=e[n],a=null,o=null;void 0===this._objects[s.id]?(o=new Phaser.Sprite(this.game,0,0,this._textureKey),a=new t.SpriterObject(this,o),this._objects[s.id]=a,this.add(o)):(a=this._objects[s.id],o=a.sprite),a.parent=s.parent,a.type=this._animation.getTimelineById(s.timeline).objectType,0===a.type?(a.setOn(!0),a.sprite.z!==s.z&&(a.sprite.z=s.z,r=!0)):a.setOn(!0,!0),(a.timelineKey!==s.key||a.timeline!==s.timeline||i)&&a.setKey(this._entity,this._animation,s.timeline,s.key)}r&&this.sort()},i.prototype.loadKeys=function(t,e){void 0===e&&(e=!1),this.setBones(t.boneRefs,e),this.setObjects(t.objectRefs,e)},i.prototype.updateAnimation=function(){if(!this._paused&&!this._finished){var e=this._mainlineStepper;this._time>this._animation.length&&(this._animation.loopType===t.eAnimationLooping.NO_LOOPING?(this._time=this._animation.length,this._finished=!0):(this._time-=this._animation.length,this.onLoop.dispatch(this)));for(var i;null!==(i=e.step(this._time));)this.loadKeys(i),e.lastTime=i.time;this.updateCharacter(),this.updateLines(),this._finished&&this.onFinish.dispatch(this),this._time+=this.game.time.physicsElapsedMS*this._animationSpeed}},i.prototype.updateCharacter=function(){for(var t=0;t<this._bones.length;t++){var e=this._bones[t];if(e.on){var i=-1===e.parent?this._root:this._bones[e.parent].transformed;e.tween(this._time),e.update(i)}}for(var t=0;t<this._objects.length;t++){var n=this._objects[t];if(n.on){var i=-1===n.parent?this._root:this._bones[n.parent].transformed;n.tween(this._time),n.update(i),0===n.type?n.updateSprite():2===n.type?this.onBoxUpdated.dispatch(this,n):3===n.type&&this.onPointUpdated.dispatch(this,n)}}},i.prototype.updateLines=function(){for(var e=this._lineSteppersCount-1;e>=0;e--)for(var i,n=this._lineSteppers[e],r=n.line;null!==(i=n.step(this._time));){switch(r.type){case t.eTimelineType.SOUND_LINE:this.onSound.dispatch(this,r.name);break;case t.eTimelineType.EVENT_LINE:this.onEvent.dispatch(this,r.name);break;case t.eTimelineType.TAG_LINE:var s=i.tagsOn,a=this._tags^s;this._tags=s;for(var o=0;o<this._spriter.tagsLength;o++){var h=1<<o;a&h&&this.onTagChange.dispatch(this,this._spriter.getTagById(o).name,(s&h)>0)}break;case t.eTimelineType.VAR_LINE:var p=i.value,l=this._vars[r.varDefId];l.value=p,this.onVariableSet.dispatch(this,l)}n.lastTime=i.time}},i}(Phaser.Group);t.SpriterGroup=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(e,i){t.call(this),this._spriter=e.spriter,this._charMapStack=e.charMapStack,this._sprite=i}return __extends(e,t),Object.defineProperty(e.prototype,"sprite",{get:function(){return this._sprite},enumerable:!0,configurable:!0}),e.prototype.setOn=function(e,i){void 0===i&&(i=!1),t.prototype.setOn.call(this,e),this._sprite.exists=e&&!i,this._sprite.visible=e&&!this._hide&&!i},e.prototype.setKey=function(e,i,n,r){if(t.prototype.setKey.call(this,e,i,n,r),0===this.type){var s=this.key,a=this._spriter.getFolderById(s.folder).getFileById(s.file);this._file=a,this.setFile(a)}else this._file=null},e.prototype.resetFile=function(){0===this.type&&this.setFile(this._file)},e.prototype.setFile=function(t){t=this._charMapStack.getFile(t),null!==t?(this._hide=!1,this._sprite.frameName=t.name):(this._hide=!0,this._sprite.visible=!1)},e.prototype.updateSprite=function(){var t=this.transformed,e=this.sprite;e.position.set(t.x,t.y),e.scale.set(t.scaleX,t.scaleY),e.anchor.set(t.pivotX,t.pivotY),e.alpha=t.alpha,e.angle=t.angle},e}(t.SpriterBone);t.SpriterObject=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t,e){this._id=t,this._name=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),t}();t.Item=e}(Spriter||(Spriter={}));var Spriter;!function(t){!function(t){t[t.NO_LOOPING=0]="NO_LOOPING",t[t.LOOPING=1]="LOOPING"}(t.eAnimationLooping||(t.eAnimationLooping={}));var e=(t.eAnimationLooping,function(e){function i(i,n,r,s){e.call(this,i,n),this._length=r,this._loopType=s,this._timelines=new t.IdNameMap,this._lines=new t.IdNameMap}return __extends(i,e),Object.defineProperty(i.prototype,"mainline",{get:function(){return this._mainline},set:function(t){this._mainline=t},enumerable:!0,configurable:!0}),i.prototype.addTimeline=function(t){this._timelines.add(t,t.id,t.name)},i.prototype.getTimelineById=function(t){return this._timelines.getById(t)},i.prototype.getTimelineByName=function(t){return this._timelines.getByName(t)},i.prototype.addLine=function(t){this._lines.add(t,this._lines.length,t.name)},i.prototype.getLineById=function(t){return this._lines.getById(t)},i.prototype.getLineByName=function(t){return this._lines.getByName(t)},Object.defineProperty(i.prototype,"linesLength",{get:function(){return this._lines.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loopType",{get:function(){return this._loopType},enumerable:!0,configurable:!0}),i}(t.Item));t.Animation=e}(Spriter||(Spriter={}));var Spriter;!function(t){!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.MAIN_LINE=1]="MAIN_LINE",t[t.TIME_LINE=2]="TIME_LINE",t[t.SOUND_LINE=3]="SOUND_LINE",t[t.EVENT_LINE=4]="EVENT_LINE",t[t.TAG_LINE=5]="TAG_LINE",t[t.VAR_LINE=6]="VAR_LINE"}(t.eTimelineType||(t.eTimelineType={}));var e=t.eTimelineType,i=function(t){function i(i,n){void 0===n&&(n=null),t.call(this,i,n),this._type=e.UNKNOWN}return __extends(i,t),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),i.prototype.add=function(t){(null===this._keys||void 0===this._keys)&&(this._keys=[]),this._keys.push(t)},i.prototype.at=function(t,e){if(void 0===e&&(e=!0),0>t)return null;var i=this._keys.length;return t>=i&&(e?(t%=i,this._keys[t].time>0&&(t=i-1)):t=i-1),this._keys[t]},i}(t.Item);t.Baseline=i}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.put=function(t,e){void 0===this._map&&(this._map={}),void 0!==this._map[t],this._map[t]=e},e.prototype.value=function(t){return this._map[t]},e}(t.Item);t.CharMap=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t){this._stack=[],this._length=0,this._entity=t}return t.prototype.reset=function(){this._length=0},t.prototype.push=function(t){var e=this.getCharMap(t);this._stack[this._length++]=e},t.prototype.remove=function(t){var e=this.getCharMap(t),i=this.findCharMap(e);if(-1!==i){for(var n=i;n<this._length-2;n++)this._stack[n]=this._stack[n+1];this._stack[--this._length]=null}},t.prototype.getFile=function(t){for(var e=this._length-1;e>=0;e--){var i=this._stack[e].value(t.name);if(void 0!==i)return i}return t},t.prototype.getCharMap=function(t){var e=this._entity.getCharMapByName(t);return e},t.prototype.findCharMap=function(t){for(var e=0;e<this._length;e++)if(this._stack[e]===t)return e;return-1},t}();t.CharMapStack=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(i,n){e.call(this,i,n),this._objectInfos=new t.IdNameMap,this._charMaps=new t.IdNameMap,this._variables=new t.IdNameMap,this._animations=new t.IdNameMap}return __extends(i,e),i.prototype.addObjectInfo=function(t){this._objectInfos.add(t,t.id,t.name)},i.prototype.getObjectInfoById=function(t){return this._objectInfos.getById(t)},i.prototype.getObjectInfoByName=function(t){return this._objectInfos.getByName(t)},i.prototype.addCharMap=function(t){this._charMaps.add(t,t.id,t.name)},i.prototype.getCharMapById=function(t){return this._charMaps.getById(t)},i.prototype.getCharMapByName=function(t){return this._charMaps.getByName(t)},Object.defineProperty(i.prototype,"charMapsLength",{get:function(){return this._charMaps.length},enumerable:!0,configurable:!0}),i.prototype.addVariable=function(t){this._variables.add(t,t.id,t.name)},i.prototype.getVariableById=function(t){return this._variables.getById(t)},i.prototype.getVariableByName=function(t){return this._variables.getByName(t)},Object.defineProperty(i.prototype,"variablesLength",{get:function(){return this._variables.length},enumerable:!0,configurable:!0}),i.prototype.addAnimation=function(t){this._animations.add(t,t.id,t.name)},i.prototype.getAnimationById=function(t){return this._animations.getById(t)},i.prototype.getAnimationByName=function(t){return this._animations.getByName(t)},Object.defineProperty(i.prototype,"animationsLength",{get:function(){return this._animations.length},enumerable:!0,configurable:!0}),i}(t.Item);t.Entity=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(e,i,n,r){t.call(this,e,i),this._pivotX=n,this._pivotY=r}return __extends(e,t),Object.defineProperty(e.prototype,"pivotX",{get:function(){return this._pivotX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotY",{get:function(){return this._pivotY},enumerable:!0,configurable:!0}),e}(t.Item);t.File=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(i,n){e.call(this,i,n),this._files=new t.IdNameMap}return __extends(i,e),i.prototype.addFile=function(t){this._files.add(t,t.id,t.name)},i.prototype.getFileById=function(t){return this._files.getById(t)},i.prototype.getFileByName=function(t){return this._files.getByName(t)},i}(t.Item);t.Folder=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t,e){this._id=t,this._time=e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){return this._time},enumerable:!0,configurable:!0}),t}();t.Key=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(i,n,r){e.call(this,i,n),this._info=new t.SpatialInfo,this._spin=r,this.setCurve(0)}return __extends(i,e),i.prototype.setCurve=function(t,e,i,n,r){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===r&&(r=0),this._curveType=t,this._c1=e,this._c2=i,this._c3=n,this._c4=r},Object.defineProperty(i.prototype,"spin",{get:function(){return this._spin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"curveType",{get:function(){return this._curveType},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"c1",{get:function(){return this._c1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"c2",{get:function(){return this._c2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"c3",{get:function(){return this._c3},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"c4",{get:function(){return this._c4},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),i}(t.Key);t.KeyTimeline=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(t.KeyTimeline);t.KeyBone=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(){t.apply(this,arguments),this._boneRefs=[],this._objectRefs=[]}return __extends(e,t),Object.defineProperty(e.prototype,"boneRefs",{get:function(){return this._boneRefs},enumerable:!0,configurable:!0}),e.prototype.addBoneRef=function(t){this._boneRefs.push(t)},Object.defineProperty(e.prototype,"objectRefs",{get:function(){return this._objectRefs},enumerable:!0,configurable:!0}),e.prototype.addObjectRef=function(t){this._objectRefs.push(t)},e}(t.Key);t.KeyMainline=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.setFolderAndFile=function(t,e){this._folder=t,this._file=e},Object.defineProperty(e.prototype,"folder",{get:function(){return this._folder},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"file",{get:function(){return this._file},enumerable:!0,configurable:!0}),e}(t.KeyTimeline);t.KeyObject=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),Object.defineProperty(e.prototype,"tagsOn",{get:function(){return this._tagsOn},set:function(t){this._tagsOn=t},enumerable:!0,configurable:!0}),e}(t.Key);t.KeyTag=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(e,i,n){t.call(this,e,i),this._value=n}return __extends(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}(t.Key);t.KeyVariable=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(e,i,n,r,s,a,o){t.call(this,e,i),this._type=n,this._width=r,this._height=s,this._pivotX=a,this._pivotY=o}return __extends(e,t),Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotX",{get:function(){return this._pivotX},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotY",{get:function(){return this._pivotY},enumerable:!0,configurable:!0}),e}(t.Item);t.ObjectInfo=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(t,e,i,n,r){void 0===r&&(r=0),this.id=t,this.parent=e,this.timeline=i,this.key=n,this.z=r}return t}();t.Ref=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(){this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.pivotX=0,this.pivotY=0,this.alpha=1,this.angle=0}return t}();t.SpatialInfo=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(i,n,r,s){void 0===r&&(r=0),void 0===s&&(s=-1),e.call(this,i,n),this.type=t.eTimelineType.TIME_LINE,this._objectType=r,this._objectRef=s}return __extends(i,e),Object.defineProperty(i.prototype,"objectType",{get:function(){return this._objectType},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"objectRef",{get:function(){return this._objectRef},enumerable:!0,configurable:!0}),i}(t.Baseline);t.Timeline=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(){function t(){}return t.getObjectTypeForName=function(e){var i=t.nameToObjectType[e];return i},t.getCurveTypeForName=function(e){var i=t.nameToCurveType[e];return i},t.getVariableTypeForName=function(e){var i=t.nameToVariableType[e];return i},t.nameToObjectType={sprite:0,bone:1,box:2,point:3,sound:4},t.nameToCurveType={instant:1,linear:0,quadratic:2,cubic:3,quartic:4,quintic:5,bezier:6},t.nameToVariableType={"int":0,"float":1,string:2},t}();t.Types=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(t){function e(e,i,n,r){t.call(this,e,i),this._type=n,this._default=r,this.reset()}return __extends(e,t),e.prototype.clone=function(){return new e(this.id,this.name,this.type,this._default)},e.prototype.reset=function(){this.value=this._default},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){0===this._type?this._value=Math.floor(t):this._value=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"int",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"float",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"string",{get:function(){return this._value},enumerable:!0,configurable:!0}),e}(t.Item);t.Variable=e}(Spriter||(Spriter={}));var Spriter;!function(t){var e=function(e){function i(i,n){e.call(this,i,null),this._varDefId=n,this.type=t.eTimelineType.VAR_LINE}return __extends(i,e),Object.defineProperty(i.prototype,"varDefId",{get:function(){return this._varDefId},enumerable:!0,configurable:!0}),i}(t.Baseline);t.Varline=e}(Spriter||(Spriter={}));var BlockBusters;!function(t){var e=function(t){function e(){t.call(this),this._userScale=new Phaser.Point(1,1),this._gameDims=new Phaser.Point,this._forceResize=!0}return __extends(e,t),e.prototype.init=function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.calcGameDims(),this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setUserScale(1,1),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.setResizeCallback(this.gameResized,this),this.game.device.desktop||this.scale.onOrientationChange.add(this.orientationChange,this)},e.prototype.create=function(){this.game.state.start("Preloader",!0,!1)},e.prototype.calcGameDims=function(){var t=window.innerWidth,e=window.innerHeight;t>e&&(t=e*(App.Global.GAME_WIDTH/App.Global.GAME_HEIGHT));var i=(t+.01)/App.Global.GAME_WIDTH,n=Math.round(e/(t/App.Global.GAME_WIDTH)),r=(e+.01)/n;this._userScale.set(i,r),this._gameDims.set(App.Global.GAME_WIDTH,n)},e.prototype.gameResized=function(t,e){if(!t.incorrectOrientation){var i=this._userScale.x,n=this._userScale.y;this.calcGameDims();var r=this._gameDims,s=this._userScale;if(r.x!==this.game.width||r.y!==this.game.height||Math.abs(s.x-i)>.001||Math.abs(s.y-n)>.001||this._forceResize){this._forceResize=!1,this.scale.setGameSize(r.x,r.y),this.scale.setUserScale(s.x,s.y);var a=this.game.state.getCurrentState();"function"==typeof a.onResize&&a.onResize(r.x,r.y)}}},e.prototype.orientationChange=function(t,e,i){},e}(Phaser.State);t.Boot=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.create=function(){this.game.state.start("Play",!0,!1)},e}(Phaser.State);t.Debil=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(){t.call(this),this._restartCounter=2}return __extends(e,t),e.prototype.create=function(){this._once=!1,this._pressed=!1;var t=this.add.image(0,0,"Tut");t.inputEnabled=!0,t.events.onInputUp.add(function(){this._pressed=!0},this),this._space=this.input.keyboard.addKey(Phaser.KeyCode.SPACEBAR)},e.prototype.onGameeRestart=function(){--this._restartCounter<=0&&(this._pressed=!0)},e.prototype.onGameeButtonDown=function(t){this._pressed=!0},e.prototype.update=function(){this._once||(this._space.justDown&&(this._pressed=!0),this._pressed&&(this._once=!0,App.Global.GAMEE&&Gamee.Gamee.instance.gameStart(),this.game.state.start("Play")))},e}(Phaser.State);t.Menu=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(t){function e(){t.call(this),this._inputCoords=new Phaser.Point,this._gameOver=!1,this._runFromRestart=!1,this._activeBlock=null,this._prevBlock=null,this._dir=1,this._speed=200,this._lastX=320}return __extends(e,t),e.prototype.onResize=function(t,e){this.setView(t,e)},e.prototype.setView=function(t,e){this.world.setBounds(-t/2,0,t/2,e),this.world.setBounds(0,0,t,e),this.camera.focusOnXY(0,0)},e.prototype.create=function(){this.setView(this.game.width,this.game.height),this.stage.backgroundColor=8450176,this.game.input.onDown.add(this.inputDown,this),this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.world.solver.iterations=20,this.game.physics.p2.gravity.y=400,this._material=this.game.physics.p2.createMaterial("material");var t=this.game.physics.p2.createMaterial("worldMaterial");this.game.physics.p2.setWorldMaterial(t,!0,!0,!0,!0);var e=this.game.physics.p2.createContactMaterial(this._material,this._material);e.friction=1,e.restitution=0,e.stiffness=1e7,e.relaxation=3,e.frictionStiffness=1e7,e.frictionRelaxation=1,e.surfaceVelocity=0,this.reset(),this.createBlock()},e.prototype.reset=function(){this._gameOver=!1,this._inputDown=!1},e.prototype.inputDown=function(t){this._inputCoords.copyFrom(t.position),this._inputCoords.subtract(this.game.width/2,this.game.height/2),this._inputDown=!0,this._activeFalling||(this._activeBlock.setZeroVelocity(),this._activeBlock.data.gravityScale=1,this._activeFalling=!0)},e.prototype.createBlock=function(){var t=this.game.add.sprite(this._lastX,32,"Block");t.anchor.set(.5,.5),this.game.physics.p2.enable(t,!0);var e=t.body;e.setMaterial(this._material),e.data.gravityScale=0,this._prevBlock=this._activeBlock,this._activeBlock=e,this._activeFalling=!1},e.prototype.update=function(){if(null!==this._activeBlock&&!this._gameOver)if(this._activeFalling){var t=!1;null!==this._activeBlock&&null!==this._prevBlock?this._prevBlock.y-(this._activeBlock.y+1*this._activeBlock.velocity.y/60)<=48&&(this._activeBlock.velocity.y/=4,t=!0):null===this._prevBlock&&this._activeBlock.y>.75*this.game.height&&this._activeBlock.velocity.y<.1&&(t=!0),t&&this.createBlock()}else{var e=this._activeBlock.x+this._dir*this._speed*(this.game.time.elapsedMS/1e3);e=Phaser.Math.clamp(e,100,540),(100===e&&-1===this._dir||540===e&&1===this._dir)&&(this._dir*=-1),this._activeBlock.x=e,this._activeBlock.setZeroVelocity(),this._lastX=e}},e.prototype.setGameOver=function(){this._gameOver||(this._gameOver=!0)},e.DEBUG=!1,e}(Phaser.State);t.PlayOld=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(e){function i(){e.call(this),this._ready=!1}return __extends(i,e),i.prototype.preload=function(){var e="assets/sfx/";if(this.game.device.ie||Phaser.Device.isAndroidStockBrowser())for(var i in t.Sounds.AUDIO_JSON.spritemap)this.load.audio(i,e+i+".mp3");else{var n=0;this.game.device.iOS&&(n=.1);var r=0;for(var i in t.Sounds.AUDIO_JSON.spritemap){var s=t.Sounds.AUDIO_JSON.spritemap[i];0!==r&&(s.start-=n),++r}this.load.audiosprite("Sfx",t.Sounds.AUDIO_JSON.resources,null,t.Sounds.AUDIO_JSON)}e="assets/",this.load.image("Background",e+"Background.jpg"),this.load.atlas("Sprites",e+"Sprites.png",e+"Sprites.json"),this.load.xml("Font",e+"font.xml"),this.load.xml("Font2",e+"font2.xml"),this.load.xml("Tutorial",e+"Tutorial.xml"),this.load.json("Config",e+"config.json")},i.prototype.create=function(){this.cache.addBitmapFontFromImage("Font",null,"Sprites",this.cache.getXML("Font"),"xml"),this.cache.addBitmapFontFromImage("Font2",null,"Sprites",this.cache.getXML("Font2"),"xml");var e=new Spriter.Loader,i=new Spriter.SpriterXml(this.game.cache.getXML("Tutorial"));if(t.Play.TUTORIAL_ANIM=e.load(i),this.readConfig(),this.game.device.ie||Phaser.Device.isAndroidStockBrowser()){Utils.AudioUtils.setSounds(null);for(var n in t.Sounds.AUDIO_JSON.spritemap){var r=this.add.audio(n);r.allowMultiple=!0,Utils.AudioUtils.addSound(n,r)}}else{var s=this.add.audioSprite("Sfx");for(var n in t.Sounds.AUDIO_JSON.spritemap){var r=s.sounds[n];r.allowMultiple=!0}Utils.AudioUtils.setSounds(s)}},i.prototype.readConfig=function(){var e=this.game.cache.getJSON("Config");for(var i in e)t.Gameplay[i]=e[i]},i.prototype.update=function(){this._ready===!1&&(this._ready=!0,this.game.state.start("Play"))},i}(Phaser.State);t.Preloader=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(e){function i(){e.call(this),this._inputCoords=new Phaser.Point,this._gameOver=!1,this._runFromRestart=!1,this._bg=null,this._board=null}return __extends(i,e),i.prototype.onResize=function(t,e){this.setView(t,e),null!==this._board&&this._board.onResize(t,e),null!==this._bg&&this._bg.resize()},i.prototype.setView=function(t,e){},i.prototype.create=function(){this.camera.bounds=null,this.setView(this.game.width,this.game.height),this.stage.backgroundColor=8450176,this._bg=new t.Background(this.game),this.world.add(this._bg),this.game.physics.startSystem(Phaser.Physics.P2JS),this.game.physics.p2.world.solver.iterations=7,this.game.physics.p2.gravity.y=t.Gameplay.GRAVITY,this.game.input.onDown.add(this.inputDown,this),this._inputKey=this.game.input.keyboard.addKey(Phaser.KeyCode.SPACEBAR),this._inputKey.onDown.add(function(){this._inputDown=!0},this),this._board=new t.Board(this.game,this.world),this._board.onScore.add(this.onScore,this),this._tutorial=new Spriter.SpriterGroup(this.game,i.TUTORIAL_ANIM,"Sprites","entity_000",0,100);var e=this.game.height>800?1:this.game.height/800*1;this._tutorial.scale.set(e),this._tutorial2=new Phaser.Group(this.game,this.world),this._tutorial2.y=this._board._floorY;var n=-t.Gameplay.BRICK_SIZE.y/2,r=this.add.sprite(0,n,"Sprites","block_red",this._tutorial2);r.anchor.set(.5,0),r.height=t.Gameplay.BRICK_SIZE.y,n-=t.Gameplay.BRICK_SIZE.y,r=this.add.sprite(-50,n,"Sprites","block_green",this._tutorial2),r.anchor.set(.5,0),r.height=t.Gameplay.BRICK_SIZE.y,n-=t.Gameplay.BRICK_SIZE.y,r=this.add.sprite(30,n,"Sprites","block_yellow",this._tutorial2),r.anchor.set(.5,0),r.height=t.Gameplay.BRICK_SIZE.y,this._board.addAt(this._tutorial2,this._board.getIndex(this._board._bricksGroup)),this._board.addAt(this._tutorial,this._board.getIndex(this._board._bricksGroup)),this.reset()},i.prototype.onGameePause=function(){this.game.paused=!0},i.prototype.onGameeUnpause=function(){this.game.paused=!1},i.prototype.onGameeRestart=function(){App.Global.game.paused=!1,Gamee.Gamee.instance.gameOver(),this.game.state.start("Debil",!0,!1),Utils.AudioUtils.playSound("start")},i.prototype.reset=function(){this._gameOver=!1,this._board.reset(),this._inputDown=!1,this._score=0,App.Global.GAMEE&&(Gamee.Gamee.instance.score=0),this._tutorial.visible=!0,this._tutorial.position.set(0,this._board._hand.y+170),this._tutorial2.visible=!0,this._tutorial.playAnimationById(0),Utils.AudioUtils.playSound("start")},i.prototype.inputDown=function(t){this._inputDown=!0},i.prototype.update=function(){if(this._tutorial.visible&&this._tutorial.updateAnimation(),!this._gameOver){if(this._inputDown&&this._tutorial.visible&&(this._tutorial.visible=!1,this._tutorial2.visible=!1),App.Global.GAMEE&&!Gamee.Gamee.instance.gameRunning&&this._inputDown)return this._inputDown=!1,void Gamee.Gamee.instance.gameStart();(!App.Global.GAMEE||App.Global.GAMEE&&Gamee.Gamee.instance.gameRunning)&&(this._board.updateBoard()?this._inputDown&&(this._board.handleInput(),this._inputDown=!1):this.setGameOver())}},i.prototype.setGameOver=function(){this._gameOver||(this._gameOver=!0,this.time.events.add(1500,function(){App.Global.GAMEE&&(this._runFromRestart=!0,Gamee.Gamee.instance.gameOver())},this))},i.prototype.onScore=function(t){this._score+=t,App.Global.GAMEE&&(Gamee.Gamee.instance.score=this._score)},i.prototype.shutdown=function(){this._bg=null,this._board=null},i.DEBUG=!1,i}(Phaser.State);t.Play=e}(BlockBusters||(BlockBusters={}));var App;!function(t){var e=function(){function t(){}return t.GAMEE=!0,t.DEBUG_GAMEE=!1,t.game=null,t.GAME_WIDTH=640,t.GAME_HEIGHT=1152,t.MAX_GAME_WIDTH=3200,t.MAX_GAME_HEIGHT=5760,t.scaleX=1,t.scaleY=1,t.correctOrientation=!1,t.musicOn=!0,t.soundOn=!0,t.showLanguages=!1,t.supportedLanguages=["en"],t.currentLanguage="en",t}();t.Global=e}(App||(App={}));var PhaserGlobal={stopFocus:!0};window.onload=function(){var t=new BlockBusters.Game;if(App.Global.game=t,App.Global.GAMEE){var e=new Gamee.Gamee("OneButton",!0);e.setGame(t)}};var BlockBusters;!function(t){var e=function(e){function i(){window.innerWidth,window.innerHeight,Phaser.AUTO;e.call(this,{width:0,height:0,renderer:Phaser.AUTO,parent:"content",transparent:!1,antialias:!0,physicsConfig:null,preserveDrawingBuffer:!0}),i.game=this,Utils.PhaserUtils.ChangeAnimationPhaserJSONData(this.additionalFrameProperties),Utils.PhaserUtils.AdjustTweenFunctions(),Utils.PhaserUtils.AddBitmapFontAddMethod(),this.state.add("Boot",t.Boot),this.state.add("Preloader",t.Preloader),this.state.add("PlayOld",t.PlayOld),this.state.add("Play",t.Play),this.state.add("Debil",t.Play),this.state.start("Boot")}return __extends(i,e),i.prototype.onMute=function(){Utils.AudioUtils.stopMusic(),App.Global.soundOn=!1,App.Global.musicOn=!1,this.sound.mute=!0},i.prototype.onUnmute=function(){
this.sound.mute=!1,App.Global.soundOn=!0,App.Global.musicOn=!0},i.prototype.additionalFrameProperties=function(t,e){e.anchor&&(t.anchorX=e.anchor.w,t.anchorY=e.anchor.h),e.nextitem&&(t.nextItemX=e.nextitem.w,t.nextItemY=e.nextitem.h)},i}(Phaser.Game);t.Game=e}(BlockBusters||(BlockBusters={}));var BlockBusters;!function(t){var e=function(){function t(){}return t.AUDIO_JSON={resources:["assets\\sfx\\Sfx.ogg","assets\\sfx\\Sfx.m4a"],spritemap:{game_over:{start:0,end:2.65,loop:!1},miss_1:{start:4,end:5.292108843537415,loop:!1},miss_2:{start:7,end:8.279818594104308,loop:!1},normal_1:{start:10,end:10.7997052154195,loop:!1},normal_2:{start:12,end:12.812834467120181,loop:!1},perfect_1:{start:14,end:15.110702947845805,loop:!1},perfect_2:{start:17,end:18.5075283446712,loop:!1},super_1:{start:20,end:22.049591836734695,loop:!1},super_2:{start:24,end:26.31528344671202,loop:!1},start:{start:28,end:28.237414965986396,loop:!1}}},t}();t.Sounds=e}(BlockBusters||(BlockBusters={}));var UI;!function(t){var e=function(t){function e(e,i,n,r,s,a,o){t.call(this,e,0,0,n),this.onClick=new Phaser.Signal,this.onDown=new Phaser.Signal,this.scaleOnOver=new Phaser.Point(1,1),this.scaleOnDown=new Phaser.Point(1,1),this.offsetOnOver=new Phaser.Point(0,0),this.offsetOnDown=new Phaser.Point(0,0),this._tinted=!1,this._downTint=8421504,this._overTint=0,this._savePosition=new Phaser.Point,this._saveScale=new Phaser.Point,this._over=!1,this._down=!1,void 0!==s&&s&&(this._tinted=!0),void 0===a&&(a=r+"Down",(this._tinted||!e.cache.getFrameByName(n,a))&&(a=null)),void 0===o&&(o=r+"Over",(this._tinted||!e.cache.getFrameByName(n,o))&&(o=null)),this.setFrames(o,r,a,r),this.anchor.setTo(.5,.5),this.name=i,this.onInputOver.add(this.overEvent,this),this.onInputOut.add(this.outEvent,this),this.onInputDown.add(this.downEvent,this),this.onInputUp.add(this.upEvent,this)}return __extends(e,t),e.prototype.setTint=function(t,e){void 0===e&&(e=16777215),this._downTint=t,this._overTint=e},e.prototype.overEvent=function(){this.setButton(!0,this._down),this.overAction()},e.prototype.outEvent=function(){this.setButton(!1,!1),this.outAction()},e.prototype.downEvent=function(){this.setButton(this._over,!0),this.downAction(),this.onDown.dispatch(this)},e.prototype.upEvent=function(t,e,i){this.setButton(this._over,!1),this.upAction(),i&&this.onClick.dispatch(this)},e.prototype.setButton=function(t,e){this._over||this._down||(this._saveScale.copyFrom(this.scale),this._savePosition.copyFrom(this.position)),this._down=e,this._over=t,e?(Phaser.Point.multiply(this._saveScale,this.scaleOnDown,this.scale),Phaser.Point.add(this._savePosition,this.offsetOnDown,this.position),this._tinted&&(this.tint=this._downTint)):t?(Phaser.Point.multiply(this._saveScale,this.scaleOnOver,this.scale),Phaser.Point.add(this._savePosition,this.offsetOnOver,this.position),this._tinted&&(this.tint=this._overTint)):(this.scale.copyFrom(this._saveScale),this.position.copyFrom(this._savePosition),this._tinted&&(this.tint=16777215))},e.prototype.overAction=function(){},e.prototype.outAction=function(){},e.prototype.downAction=function(){Utils.AudioUtils.playSound("click")},e.prototype.upAction=function(){},e}(Phaser.Button);t.Button=e}(UI||(UI={}));var UI;!function(t){var e=function(t){function e(e,i,n,r,s,a,o,h){t.call(this,e,i,n,r,a,o,h),this._changeOnDown=!1,this._checkFramePosition=new Phaser.Point,this._checked=!1;var p=s+"On";!this.game.cache.getFrameByName(n,p),this._frameChecked=p;var l=s+"Off";this.game.cache.getFrameByName(n,p)||(l=null),this._frameUnchecked=l;var c=new Phaser.Sprite(e,0,0,n);c.anchor.set(.5,.5),this.addChild(c),this._checkSprite=c,this.checked=!1}return __extends(e,t),Object.defineProperty(e.prototype,"checked",{get:function(){return this._checked},set:function(t){if(this._checked=t,t)this._checkSprite.frameName=this._frameChecked,this._checkSprite.visible=!0;else{var e=null!==this._frameUnchecked;e&&(this._checkSprite.frameName=this._frameUnchecked),this._checkSprite.visible=e}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeOnDown",{get:function(){return this._changeOnDown},set:function(t){this._changeOnDown=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkSprite",{get:function(){return this._checkSprite},enumerable:!0,configurable:!0}),e.prototype.setCheckPosition=function(t,e){this._checkSprite.position.set(t,e)},e.prototype.downEvent=function(){this.setButton(this._over,!0),this._changeOnDown&&(this.checked=!this.checked),this.downAction(),this.onDown.dispatch(this,this._checked)},e.prototype.upEvent=function(t,e,i){this.setButton(this._over,!1),this.upAction(),i&&(this._changeOnDown||(this.checked=!this.checked),this.onClick.dispatch(this,this._checked))},e}(t.Button);t.CheckBox=e}(UI||(UI={}));var UI;!function(t){!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP=1]="TOP",t[t.TOP_RIGHT=2]="TOP_RIGHT",t[t.LEFT=3]="LEFT",t[t.CENTER=4]="CENTER",t[t.RIGHT=5]="RIGHT",t[t.BOTTOM_LEFT=6]="BOTTOM_LEFT",t[t.BOTTOM=7]="BOTTOM",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(t.eGroupPlacement||(t.eGroupPlacement={}));var e=(t.eGroupPlacement,function(t){function e(e,i){void 0===i&&(i=null),t.call(this,e,i),this._groups=[]}return __extends(e,t),e.prototype.hasGroupAt=function(t){var e=this._groups[t];return void 0!==e&&null!==e},e.prototype.groupAt=function(t,e){void 0===e&&(e=!0);var i=this._groups[t];return void 0!==i&&null!==i||!e||(i=new Phaser.Group(this.game,this),i.fixedToCamera=!0,this._groups[t]=i,this.arrangeGroup(t)),i},e.prototype.arrangeGroups=function(){for(var t=0;t<this._groups.length;t++){var e=this._groups[t];void 0!==e&&null!==e&&this.arrangeGroup(t)}},e.prototype.arrangeGroup=function(t){var e=t%3,i=Math.floor(t/3),n=this._groups[t];if(void 0!==n&&null!==n){var r=this.game.width*e/2,s=this.game.height*i/2;n.cameraOffset.set(r,s)}},e}(Phaser.Group));t.UILayer=e}(UI||(UI={}));var Utils;!function(t){var e=function(){function t(){}return t.setSounds=function(e,i){void 0===i&&(i=null),t._sfx=e,t._sfxIds=i,t._isAudioSprite=null!==e&&e instanceof Phaser.AudioSprite},t.addSound=function(e,i){t._sfxs[e]=i},t.playSoundRnd=function(e,i,n){null!==e&&0!==e.length&&t.playSound(Phaser.ArrayUtils.getRandomItem(e,i,n))},t.playSound=function(e){var i=t.getSoundName(e);App.Global.soundOn&&(null!==t._sfx?t._isAudioSprite?t._sfx.play(i):t._sfx.play(i):void 0!==t._sfxs[i]&&t._sfxs[i].play())},t.stopSound=function(e){var i=t.getSoundName(e);null!==t._sfx?t._isAudioSprite&&t._sfx.stop(i):void 0!==t._sfxs[i]&&t._sfxs[i].stop()},t.getSoundName=function(e){var i;return i="number"==typeof e?t._sfxIds[e]:e},Object.defineProperty(t,"currentMusic",{get:function(){return t._currentMusic},enumerable:!0,configurable:!0}),Object.defineProperty(t,"isMusicPlaying",{get:function(){if(null===this._currentMusic||0===this._currentMusic.length)return!1;var e=t._music[t._currentMusic];return e.isPlaying},enumerable:!0,configurable:!0}),t.addMusic=function(e,i){t._music[e]=i},t.playMusic=function(e,i){if(void 0===i&&(i=!0),t._currentMusic!==e&&(null!==t._currentMusic&&t._currentMusic.length>0&&t.stopMusic(),e in t._music&&App.Global.musicOn)){t._currentMusic=e;var n=t._music[e];n.loop=i,n.play(),i||n.onStop.addOnce(function(){t.onFinished.dispatch(e)},this)}},t.stopMusic=function(){if(null!==t._currentMusic&&t._currentMusic.length>0){var e=t._music[t._currentMusic];e.isPlaying&&e.stop(),t._currentMusic=""}},t.pauseMusic=function(){if(null!==t._currentMusic&&t._currentMusic.length>0){var e=t._music[t._currentMusic];e.isPlaying&&e.pause()}},t.resumeMusic=function(){if(null!==t._currentMusic&&t._currentMusic.length>0){var e=t._music[t._currentMusic];e.paused&&e.resume()}},t._sfx=null,t._isAudioSprite=!1,t._sfxs={},t._music={},t._currentMusic="",t.onFinished=new Phaser.Signal,t}();t.AudioUtils=e}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.supported=function(){return App.Global.game.scale.compatibility.supportsFullScreen},t.isFullscreen=function(){return App.Global.game.scale.isFullScreen},t.changeFullscreen=function(){var t=App.Global.game,e=t.scale.isFullScreen;e?t.scale.stopFullScreen():t.scale.startFullScreen(!1,!1)},t}();t.FullscreenUtils=e}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.ChangeAnimationPhaserJSONData=function(t){Phaser.AnimationParser.myCallback=t,Phaser.AnimationParser.JSONData=function(t,e){if(e.frames){for(var i=new Phaser.FrameData,n=e.frames,r=0;r<n.length;r++){var s=i.addFrame(new Phaser.Frame(r,n[r].frame.x,n[r].frame.y,n[r].frame.w,n[r].frame.h,n[r].filename));n[r].trimmed&&s.setTrim(n[r].trimmed,n[r].sourceSize.w,n[r].sourceSize.h,n[r].spriteSourceSize.x,n[r].spriteSourceSize.y,n[r].spriteSourceSize.w,n[r].spriteSourceSize.h),Phaser.AnimationParser.myCallback(s,n[r])}return i}}},t.AdjustTweenFunctions=function(){Phaser.TweenManager.prototype.removeFromUpdateQueue=function(t){var e=this._tweens.indexOf(t);-1!==e?this._tweens.splice(e,1):(e=this._add.indexOf(t),-1!==e&&this._add.splice(e,1))},Phaser.Tween.prototype.stopAndRemoveFromUpdateQueue=function(t){var e=this,i=e.stop(t);return e.manager.removeFromUpdateQueue(e),e.pendingDelete=!1,i}},t.AddBitmapFontAddMethod=function(){Phaser.Cache.prototype.addBitmapFontFromImage=function(t,e,i,n,r,s,a){var o=this.getImage(i,!0),h={url:e,data:o.data,font:null,base:o.base};void 0===s&&(s=0),void 0===a&&(a=0),"json"===r?h.font=Phaser.LoaderParser.jsonBitmapFont(n,h.base,s,a):h.font=Phaser.LoaderParser.xmlBitmapFont(n,h.base,s,a),this._cache.bitmapFont[t]=h,this._resolveURL(e,h)}},t}();t.PhaserUtils=e}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t}();t.ScreenMetrics=e,function(t){t[t.PORTRAIT=0]="PORTRAIT",t[t.LANDSCAPE=1]="LANDSCAPE"}(t.eOrientation||(t.eOrientation={}));var i=t.eOrientation,n=function(){function t(){}return t.calculateScreenMetrics=function(t,n,r,s,a,o){void 0===r&&(r=i.LANDSCAPE);var h,p;if(h=window.innerWidth,p=window.innerHeight,(p>h&&r===i.LANDSCAPE||h>p&&r===i.PORTRAIT)&&!s){var l=h;h=p,p=l}("undefined"==typeof a||"undefined"==typeof o)&&(r===i.LANDSCAPE?(a=Math.round(1024*t/960),o=Math.round(720*n/600)):(a=Math.round(720*t/600),o=Math.round(1024*n/960)));var c=t/n,u=h/p,_=0,d=0,f=0,m=0;u>c?(m=n,f=2*Math.ceil(m*u/2),f=Math.min(f,a),_=(f-t)/2,d=0):(f=t,m=2*Math.ceil(f/u/2),m=Math.min(m,o),_=0,d=(m-n)/2);var g=(h+.01)/f,y=(p+.01)/m;return s&&r===i.LANDSCAPE&&(g=y),this.screenMetrics=new e,this.screenMetrics.windowWidth=h,this.screenMetrics.windowHeight=p,this.screenMetrics.defaultGameWidth=t,this.screenMetrics.defaultGameHeight=n,this.screenMetrics.maxGameWidth=a,this.screenMetrics.maxGameHeight=o,this.screenMetrics.gameWidth=f,this.screenMetrics.gameHeight=m,this.screenMetrics.scaleX=g,this.screenMetrics.scaleY=y,this.screenMetrics.offsetX=_,this.screenMetrics.offsetY=d,this.screenMetrics},t}();t.ScreenUtils=n}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t}(),i=function(){function t(){}return t.save=function(){var i=new e;i.musicOn=App.Global.musicOn,i.soundOn=App.Global.soundOn,i.currentLanguage=App.Global.currentLanguage;var n=t.getLocalStorage();if(null!==n){var r=JSON.stringify(i);n.setItem("blockbusters_save",r)}},t.load=function(){var e=null;if(null===e||void 0===e){var i=t.getLocalStorage();if(null===i)return!1;e=JSON.parse(i.getItem("blockbusters_save"))}return null===e||void 0===e?!1:(App.Global.musicOn=e.musicOn,App.Global.soundOn=e.soundOn,App.Global.currentLanguage=e.currentLanguage,!0)},t.getLocalStorage=function(){try{if("localStorage"in window&&null!==window.localStorage)return localStorage}catch(t){return null}return null},t}();t.StorageUtils=i}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.padNumber=function(t,e,i){void 0===i&&(i="0");var n=t+"";return n.length>=e?n:new Array(e-n.length+1).join(i)+n},t.addSpacingToNumber=function(t,e){return void 0===e&&(e=" "),(""+t).replace(/\B(?=(\d{3})+(?!\d))/g,e)},t.formatTime=function(e,i,n,r){void 0===n&&(n=-1),void 0===r&&(r=":"),e=Math.floor(e);var s=!1,a="";if(e>3600||0===i){var o=Math.floor(e/3600);a+=(-1!==n?t.padNumber(o,n):o)+r,e%=3600,s=!0}if(s===!0||e>60||1===i){var h=Math.floor(e/60);a+=(-1!==n?t.padNumber(h,n):h)+r,e%=60,s=!0}var p=e;return a+=-1!==n?t.padNumber(p,n):p},t}();t.StringUtils=e}(Utils||(Utils={}));var Utils;!function(t){var e=function(){function t(){}return t.setTexts=function(e){t._texts=e},t.getText=function(e,i){if(null===t._texts)return"Texts not set";"undefined"==typeof i&&(i=App.Global.currentLanguage);var n=t._texts[i];if("undefined"==typeof n)return"Invalid language "+i;var r=n[e];return"undefined"==typeof r?"!MISSING TEXT!":r},t._texts=null,t}();t.TextUtils=e}(Utils||(Utils={}));
